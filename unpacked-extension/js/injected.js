/**
 * @author Sven Ackermann (svenrecknagel@gmail.com)
 * @license BSD license
 */
!function(){function e(e,t,r,n){if(t){var a=new MouseEvent(e,{bubbles:!0,cancelable:!0,view:window,detail:1,clientX:r||0,clientY:n||0,buttons:1,relatedTarget:t});t.dispatchEvent(a)}}function t(e){e&&e.click()}function r(){var r,n=location.hash.substr(2);if(n.indexOf("artist/")||(r=document.querySelector("#music-content .actions [data-id='radio']")),r=r||document.querySelector("#music-content .material-container-details [data-id='play']"))t(r);else if(n.indexOf("tg/"))l({index:0});else{var a=document.querySelector("#music-content .material-card[data-type='tgs'] .play-button-container");e("mouseover",a),setTimeout(function(){t(a.querySelector(".play-button"))},200)}}function n(e){t(document.querySelector(".material-card[data-id='"+e+"'] .title"))}function a(){t(document.querySelector(".material-card[data-type='imfl'] .title"))}function i(e,r,n){var a=document.querySelector("#player .material-player-middle [data-id='"+e+"']");if(a){var i=a.className||"";if(r&&i.indexOf(r)<0)return;if(n&&i.indexOf(n)>=0)return;t(a)}}function o(e,t,r,n){var a=document.querySelector(r?"#queueContainer":"#music-content");if(a){t&&(a=a.querySelectorAll(".cluster")[t-1]);var i,o=a.querySelectorAll(".song-table");if(t?i=o[0]:[].some.call(o,function(e){for(;e&&e.id!=a.id;){if(e.classList.contains("cluster"))return!1;e=e.parentElement}return i=e,!0}),i){var u=i.querySelectorAll(".song-row");if(u[0]&&(e-=u[0].dataset.index,u[e])){var c="td";return n&&(c+="[data-col='"+n+"']"),u[e].querySelector(c)}}}return null}function u(e,t){window.postMessage({type:"FROM_PRIMEPLAYER",msg:"plSong"+e,index:t},location.href)}function c(r,n){if(!r)return!1;var a=r.querySelector(".column-content");return!!a&&(e("mouseover",a),setTimeout(function(){t(a.querySelector(".hover-button")),n()},200),!0)}function l(e){c(o(e.index,e.cluster,"#/ap/queue"==e.link),u.bind(window,"Started",e.index))||u("Error",e.index)}function s(e){c(o(e.index,0,!1),function(){e.position>0&&setTimeout(y.bind(window,"#material-player-progress",e.position),1e3)})}function d(e,r){if(!(e=e.querySelector(".rating-container")))return!1;var n,a=e.querySelector("[data-rating='"+r+"']");try{if(!a){if(r<2||r>4)return!1;if(!(a=e.querySelector("[data-rating='5']")))return!1;n=!0,a.dataset.rating=r}t(a)}finally{n&&(a.dataset.rating=5)}return!0}function f(t){var r=o(t.index,t.cluster,"#/ap/queue"==t.link,"rating");r?(e("mouseover",r),setTimeout(function(){d(r,t.rating)?setTimeout(u.bind(window,"Rated",t.index),200):u("Error",t.index)},200)):u("Error",t.index)}function m(e){d(document.querySelector("#playerSongInfo"),e)}function y(t,r){var n=document.querySelector(t),a=n.querySelector("#sliderBar"),i=a.getBoundingClientRect(),o=i.left+r*i.width,u=i.top+1;e("mousedown",a,o,u),setTimeout(function(){e("mouseup",a,o,u)},250)}function p(){y("#material-vslider",document.querySelector("#material-vslider").getAttribute("aria-valuenow")/100)}function g(){window.removeEventListener("message",v)}function v(e){if(e.source==window&&"FROM_PRIMEPLAYER"==e.data.type&&e.data.command){var o=e.data.options;switch(e.data.command){case"playPause":var u=o.resume;i("play-pause",!1===u?"playing":null,u?"playing":null);break;case"nextSong":i("forward");break;case"prevSong":i("rewind");break;case"toggleRepeat":i("repeat");break;case"toggleShuffle":i("shuffle");break;case"openQueue":t(document.querySelector("#queue"));break;case"rate":m(o.rating);break;case"startPlaylist":r();break;case"setPosition":y("#material-player-progress",o.percent);break;case"setVolume":y("#material-vslider",o.percent);break;case"clickCard":n(o.id);break;case"feelingLucky":a();break;case"startPlaylistSong":l(o);break;case"resumePlaylistSong":s(o);break;case"ratePlaylistSong":f(o);break;case"simulateActivity":p();break;case"cleanup":g()}}}window.addEventListener("message",v)}();