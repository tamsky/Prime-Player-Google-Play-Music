/**
 * @author Sven Ackermann (svenrecknagel@gmail.com)
 * @license BSD license
 */
chrome.runtime.getBackgroundPage(function(t){function i(t){return!xt[t]&&!!t.indexOf("sm/")&&!!t.indexOf("sr")}function n(t){$("html").toggleClass("hideRatings",t),!t&&!1===wt&&$t&&$t()}function e(t){$("#favicon").attr("href",t)}function a(t){$("#repeat").attr("class",t)}function l(){return $("#navlistContainer").find(".playlist:visible")}function s(t){$("#shuffle").attr("class",t),"ALL_SHUFFLE"==t&&"#/ap/queue"==bt.controlLink&&l().length&&(bt.link="ap/queue",Z(bt.title,bt.link))}function o(t){$("#prev").toggleClass("enabled",t)}function r(t){$("#next").toggleClass("enabled",t)}function c(t){$("#resume").toggleClass("enabled",null!==t),$("body").toggleClass("playing",!0===t)}function d(t){$("#songTime").text(t.duration),$("#track").text(t.title),$("#artist").text(t.artist).attr("title",t.artist).data("link",t.artistLink).toggleClass("nav",void 0!==t.artistLink),$("#album").text(t.album).attr("title",t.album).data("link",t.albumLink).toggleClass("nav",null!==t.albumLink),$("#cover").attr("src",t.cover||"img/cover.png"),$("#showlyrics").attr("title",Lt("lyricsFor",t.title)).addClass("nav").data("options",{artist:t.artist,title:t.title})}function u(t){return function(){return $(this).data("cluster")===t}}function f(t){var i=$("<div class='timebar'><div></div></div>"),n=Pt.info?Pt.info.durationSec:0;m(i,n?Pt.positionSec/n*100:0),i.appendTo(t.find(".current"))}function v(t){var i=t.title;return t.artist&&(i=t.artist+" - "+i),i}function g(t){var i=Lt("extTitle");t&&Pt.info&&(i=v(Pt.info)+" - "+i),$("head > title").text(i)}function p(i){function n(n){var e=n.data("song");return!!t.songsEqual(e,i)&&(n.addClass("current"),e.current=!0,!0)}function e(t){var i=a.filter(u(t.cluster)).children("div[data-index='"+t.index+"']");return i[0]&&n(i)}$("body").hasClass("hasLastSong")&&($("body").removeClass("hasLastSong"),$("#googleRating a").removeClass("disabled"),y(Pt.rating),$t=null,wt=!1,$("#resume").removeClass("lastSongEnabled").off().click(et("playPause",{resume:!0}))),$("body").toggleClass("hasSong",!!i),i?(d(i),L(Pt.scrobbleTime),St.lyricsAutoReload&&$("#lyrics").is(":visible")&&Z(Lt("lyricsTitle",v(i)),"lyrics",null,{artist:i.artist,title:i.title})):($("#cover").attr("src","img/cover.png"),$("#showlyrics").removeAttr("title").removeClass("nav").removeData("options")),g(St.mpShowTitle);var a=l();if(a.length){var s;if(a.children(".current").each(function(){var t=$(this);t.data("song").current=!1,t.children(".timebar").remove(),t.removeClass("current"),s={cluster:x(t),index:t.data("index")}}),i){var o=!1;i.playlist==bt.controlLink&&(o=e(i)),!o&&s&&(s.index++,(o=e(s))||(s.index-=2,o=e(s))),o||a.children("div").each(function(){n($(this))&&(o=!0)}),o&&f(a)}}}function m(t,i){t.children("div").css({width:i+"%"})}function h(t,i,n){$("#currentTime").text(n);var e=i?t/i*100:0;$("#timeBar").css({width:e+"%"}),m($(".playlist:visible>.current>.timebar"),e)}function k(t){h(t,Pt.info&&Pt.info.durationSec||0,Pt.position)}function y(t){$("#googleRating").removeClass().addClass("rating-"+t)}function b(i){function n(t){e(null),t(i.info,e)}function e(t,i){rt(t,{getLastfmInfo:$t,unlove:a,love:l}),void 0!==i&&(wt=i,ot(i))}$("body").addClass("hasLastSong"),$("#googleRating a").addClass("disabled"),d(i.info),h(i.positionSec,i.info.durationSec,i.position),y(i.rating),$t=n.bind(window,t.getLastfmInfo);var a=n.bind(window,t.unlove),l=n.bind(window,t.love);(St.showLastfmInfo||!St.hideRatings&&Tt.lastfmSessionName)&&$t(),i.info.albumLink&&$("#resume").addClass("lastSongEnabled").off().click(t.resumeLastSong.bind(window,i))}function w(t){var i=$("body");if(i.toggleClass("star-rating",t),i.toggleClass("thumbs-rating",!t),ht="",t){ht="<div></div>";for(var n=1;n<=5;n++)ht+="<a tabindex='0' data-rating='"+n+"'></a>"}else ht="<a tabindex='0' data-rating='5'></a><a tabindex='0' data-rating='1'></a>"}function x(t){return parseInt(t.closest(".playlist").data("cluster"))||0}function C(t){$("body").hasClass("hasLastSong")||y(t)}function L(t){var i=$("#scrobblePosition");t>=0&&Pt.info&&Pt.info.durationSec>0?i.addClass("songscrobble").css({left:t/Pt.info.durationSec*100+"%"}):i.removeClass("songscrobble")}function T(t){$("body").toggleClass("scrobbled",t)}function S(t){$("body").toggleClass("scrobbleEnabled",t)}function I(t){$("#lastfmInfo").toggle(t),t&&!1===wt&&$t&&$t()}function P(t,i){$("html").removeClass("color-"+i).addClass("color-"+t)}function R(t){$("#player").css("background-color",t)}function H(t){$("#player").css("color",t)}function q(t){$("#nav").toggleClass("searchField",!t)}function E(t){$("#feelingLucky").toggle(!t)}function z(i,n){if(i=$(i),i.toggleClass("nav",!!n),n){var e=t.getTextForQuicklink(n);i.data({link:n,text:e}).attr("title",Lt("openLink",e))}else i.removeData("link text").removeAttr("title")}function M(){var t;$(window).resize(function(){clearTimeout(t),t=setTimeout(function(){if(!document.webkitHidden){var t;if($("#player").is(":visible"))t=Tt.miniplayerSizing,t[St.layout].width=window.outerWidth,t[St.layout].height=window.outerHeight,Tt.miniplayerSizing=t;else if($("#nav").is(":visible")){var i;i=$("#quicklinks").is(":visible")?"quicklinks":$("#favoritesContainer").is(":visible")?"favorites":$("#lyrics").is(":visible")?"lyrics":$("#navlist").attr("class");var n=i+"Sizing";t=Tt[n],t&&(t.width=window.outerWidth,t.height=window.outerHeight,Tt[n]=t)}}},500)});var i=window.screenX,n=window.screenY;setInterval(function(){if($("#player").is(":visible")&&(i!=window.screenX||n!=window.screenY)&&!document.webkitHidden){i=window.screenX,n=window.screenY;var t=Tt.miniplayerSizing;t[St.layout].left=i,t[St.layout].top=n,Tt.miniplayerSizing=t}},1e3)}function O(){var t=setTimeout(function(){window.close()},1e3*St.toastDuration);$(window).mouseover(function(){clearTimeout(t)}),$(window).mouseout(function(){t=setTimeout(function(){window.close()},3e3)})}function F(t){$("body").toggleClass("lastfm",null!==t),t&&($("#lastfmUser").attr("title",Lt("lastfmUser")+t).attr("href","http://last.fm/user/"+t),!St.hideRatings&&$t&&$t())}function _(t){$("body").toggleClass("lyrics",t)}function B(t){$("#lyrics").css("font-size",t+"px")}function U(t){null===t?$("#volumeBarContainer").hide():($("#volumeBar").css({width:t+"%"}),$("#volume").toggleClass("muted","0"==t))}function D(){!St.saveLastPosition||!1!==wt||It.connected&&Pt.info||t.getLastSong(b)}function X(t){$("body").toggleClass("connected",t),t||tt(),D()}function G(t){t?D():Pt.info||p(null)}function A(t){$("body").toggleClass("hidefav",t)}function Y(t){"miniplayer"!=kt&&"toast"!=kt||window.resizeTo(t.width,t.height)}function Q(t,i,n){var e=!!Ct[i];return t.data("fav",{link:i,title:n}).attr("title",Lt(e?"delfavorite":"addfavorite",n)).toggleClass("isfav",e)}function K(t,n){return i(t)?Q($("<a class='fav'>"),t,n):$("<a class='fav' style='visibility:hidden'>")}function N(t){if(null!==t&&t.controlLink==bt.controlLink){var i=l().filter(u(t.cluster)).children("div[data-index='"+t.index+"']");if(i.length){var n=i.data("song");i.children("div.rating").removeClass("r"+n.rating).addClass("r"+t.rating),n.rating=t.rating}}}function W(t,i){var n=$("<h2>").text(t.header);i.append(n);var e=$("<div>").addClass(t.type).appendTo(i);Et[t.type](e,t.list,!1,t.cluster,n),t.moreLink&&$("<a tabindex='0' class='nav'>").data("link",t.moreLink).appendTo(n)}function V(t){if(t&&t.link==bt.link){It.navigationList=null,bt.controlLink=t.controlLink;var i=$("#navlist");if(t.error)i.removeClass().html("<div class='error'>");else if(t.empty)i.removeClass().html("<div class='empty'>");else{t.update||(i.empty().removeClass().addClass(t.type),Y(Tt[t.type+"Sizing"]));var n=$("#navHead").children("span");"mixed"==t.type?(i.removeData("cluster"),n.text(t.header),t.lists.forEach(function(t){W(t,i)}),i.find("h2 a.nav").data("text",t.header).text(t.moreText)):Et[t.type](i,t.list,t.update,0,n)}}}function j(i,n,e,a,l){i.removeClass("loading");var s=i.children(".content"),o=i.children(".credits");l.error?s.html("<div class='error'>"):l.noresults?s.html("<div class='empty'>"):($("#navHead").children("span").text(l.title.text().trim()),s.html(l.lyrics.html()),l.credits&&o.html(l.credits.html()+"<hr>")),o.append(Lt("lyricsSrcProvider",t.lyricsProviders[a].getUrl())),l.src&&$("<a target='_blank'>").attr("href",l.src).text(Lt("lyricsSrc")).appendTo(o),l.searchSrc&&$("<a target='_blank'>").attr("href",l.searchSrc).text(Lt("lyricsSearchResult")).appendTo(o),o.append("<br>"),e.forEach(function(i){var a=e.slice();a.splice(a.indexOf(i),1),$("<a class='nav'>").data("options",$.extend({},n,{providers:a})).data("link","lyrics/"+i).text(Lt("lyricsSearchProvider",t.lyricsProviders[i].getUrl())).appendTo(o)})}function J(){$("#favorites").find("input").remove().end().find(".nav").removeAttr("style")}function Z(n,e,a,l){function s(t){return!t.indexOf("sr/")}!$("#player").is(":visible")||"miniplayer"!=kt&&"toast"!=kt||(mt={height:window.outerHeight,width:window.outerWidth,screenX:window.screenX-screen.availLeft,screenY:window.screenY}),!bt.link||bt.link==e||s(bt.link)&&s(e)||yt.push(bt),bt={link:e,title:n,search:a,options:l},it(n),$("#navlist").empty().removeClass();var o=$("#lyrics");o.removeClass().hide().children().empty(),s(e)||$("#navHead > input").val(""),$("#player,#navlistContainer,#quicklinks,#favoritesContainer,#navHead .fav").hide();var r=e;if("quicklinks"==e)Y(Tt.quicklinksSizing),$("#quicklinks").show();else if("favorites"==e)Y(Tt.favoritesSizing),J(),$("#favoritesContainer").show();else if(e.indexOf("lyrics"))r="navlist",$("#navlist").addClass("loading"),$("#navlistContainer").show(),i(e)&&Q($("#navHead .fav"),e,n).show(),t.loadNavigationList(e);else{o.addClass("loading"),Y(Tt.lyricsSizing),o.show();var c=e.indexOf("/")+1;c?t.fetchLyricsFrom(l,e.substr(c),j.bind(window,o,l,l.providers)):t.fetchLyrics(l,j.bind(window,o,l))}$("#nav").show(),Rt.pageview(r)}function tt(){if($("#nav").hide(),$("#navlist").empty(),mt){Y(mt);var t=mt.screenX,i=mt.screenY;setTimeout(function(){window.moveTo(t,i)},200),mt=null}yt=[],bt={};var n=$("#player");n.is(":visible")||Rt.pageview(kt),n.show()}function it(t){var i=yt.length>0?Lt("backToLink",yt[yt.length-1].title):Lt("backToPlayer");$("#navHead").children(".back").attr("title",i).end().children("span").text(t)}function nt(){function i(t,i){if(i.ctrlKey){i.stopImmediatePropagation();var n=Pt.lastfmInfo||wt;n&&n[t]&&chrome.tabs.create({url:n[t]})}}$("#navHead .back").click(function(){if(yt.length){var t=yt.pop();bt={},t.search&&$("#navHead > input").val(t.search),Z(t.title,t.link,t.search,t.options)}else tt()}),$("#navHead .close").attr("title",Lt("close")).click(tt);var n;$("#navHead > input").keyup(function(){clearTimeout(n),n=setTimeout(function(){var i=$.trim($("#navHead > input").val());i.length>1&&Z(Lt("searchResults"),t.getSearchLink(i),i)},500)}),$("#track").click(i.bind(window,"url")),$("#artist").click(i.bind(window,"artistUrl")),$("#album").click(i.bind(window,"albumUrl")),$("body").on("click",".nav",function(i){var n=$(this),e=n.data("link");if(e){var a,l=n.data("options"),s=!e.indexOf("lyrics");if(s){if(St.openLyricsInMiniplayer==i.shiftKey)return void t.openLyrics(l);if(!l){if(!Pt.info)return;l={artist:Pt.info.artist,title:Pt.info.title}}a=l.title,l.artist&&(a=l.artist+" - "+a),a=Lt("lyricsTitle",a)}else a=n.data("text")||n.text();return St.openLinksInMiniplayer!=i.shiftKey||"quicklinks"==e||s?Z(a,e,null,l):t.selectLink(e),!1}}),$(window).keyup(function(i){var n=i.keyCode;if(27==n)$("#player").is(":visible")||tt();else{if($("input").is(":focus"))return;if(81==n){if(!St.hideSearchfield){var e=$("#navHead > input");e.is(":focus")||e.is(":disabled")||(e.is(":visible")||Z(Lt("quicklinks"),"quicklinks"),e.focus())}}else 32==n&&t.executePlayPause()}}),$("#navlistContainer").on("click",".playlistsList img,.albumContainers img",function(){t.startPlaylist($(this).parent().find(".album,.title").data("link")),tt()}).on("click",".playlist img",function(){var i=$(this).closest("div[data-index]");i.hasClass("current")?t.executeInGoogleMusic("playPause"):t.executeInGoogleMusic("startPlaylistSong",{link:bt.controlLink,index:i.data("index"),cluster:x(i)})}).on("click",".playlist a[data-rating]",function(){var i=$(this).closest("div[data-index]"),n=$(this).data("rating");if(i.hasClass("current"))t.rate(n);else{var e=i.data("index"),a=i.data("song");if(a.rating<0)return;St.linkRatings&&(n>=St.linkRatingsMin&&!t.isRatingReset(a.rating,n)?t.love(a,$.noop):St.linkRatingsReset&&t.unlove(a,$.noop)),t.executeInGoogleMusic("ratePlaylistSong",{link:bt.controlLink,index:e,cluster:x(i),rating:n})}});var e=Tt.favorites;$("#nav").on("click",".fav",function(){var t=$(this),i=t.data("fav"),n=i.link;if(Ct[n]){var a=-1;e.some(function(t,i){if(t.link==n)return a=i,!0}),a>=0&&e.splice(a,1),delete Ct[n]}else e.unshift(i),Ct[n]=!0;Q(t,n,i.title),Tt.favorites=e});$("#favoritesContainer").on("click","img",function(){t.startPlaylist($(this).siblings(".nav").data("link")),tt()}).on("click",".edit",function(){var t=$(this).siblings(".nav");J(),t.hide();var i=$("<input type='text'>").val(t.text());t.after(i),i.focus()}).on("keyup focusout","input",function(t){var i=t.keyCode;if(27==i)this.done=!0,J();else if(!this.done&&(13==i||"focusout"==t.type)){var n=$.trim($(this).val());if(n){this.done=!0;var a=e[$(this).parent().index()];a.title!=n?(a.title=n,Tt.favorites=e):J()}else"focusout"==t.type&&(this.done=!0,J())}return!1}).on("dragover",".sortable div",function(t){var i=t.originalEvent.dataTransfer.types,n=$(this).index(),e=i.indexOf("srcfavorite")>=0&&i.indexOf("srcfavorite/"+n)<0&&i.indexOf("srcfavorite/"+(n-1))<0;return $(this).toggleClass("dragging",e),!e}).on("dragleave",".sortable div",function(){$(this).removeClass("dragging")}).on("drop",".sortable div",function(t){$(this).removeClass("dragging");var i=t.originalEvent.dataTransfer.getData("srcfavorite"),n=$(this).index(),a=e.splice(i,1)[0];return i<n&&n--,e.splice(n,0,a),Tt.favorites=e,!1}).on("dragstart",".sortable div[draggable='true']",function(t){var i=t.originalEvent.dataTransfer,n=$(this).index();i.setData("srcfavorite",n),i.setData("srcfavorite/"+n,"")})}function et(i,n){return function(){1==$(this).css("opacity")&&t.executeInGoogleMusic(i,n)}}function at(){$("#pause").click(et("playPause",{resume:!1})).attr("title",Lt("pauseSong")),$("#resume").click(et("playPause",{resume:!0})).attr("title",Lt("resumeSong")),$("#prev").click(et("prevSong")).attr("title",Lt("prevSong")),$("#next").click(et("nextSong")).attr("title",Lt("nextSong")),$("#repeat").click(et("toggleRepeat")).attr("title",Lt("command_toggleRepeat")),$("#shuffle").click(et("toggleShuffle")).attr("title",Lt("command_toggleShuffle")),$("#volume").click(dt).attr("title",Lt("volumeControl")),$("#volumeBarBorder").click(gt)}function lt(){$("html").on("click",".hasSong #googleRating > .rating-container > a",function(){var i=$(this).attr("class"),n=i.substr(i.indexOf("rating-")+7,1);t.rate(n)})}function st(t){var i=t.data("msg")||"",n=t.data("lastfmInfo");n&&(i+="\n"+n),t.attr("title",i)}function ot(t){var i="";t?(i=Lt("lastfmInfo_userplaycount",t.userplaycount+"")+"\n"+Lt("lastfmInfo_playcount",t.playcount+"")+"\n"+Lt("lastfmInfo_listeners",t.listeners+""),$("#lastfmInfo").addClass("hasInfo").find(".userplaycount > span").text(t.userplaycount).end().find(".playcount > span").text(t.playcount).end().find(".listeners > span").text(t.listeners)):$("#lastfmInfo").removeClass("hasInfo").find("span").text("?");var n=$("#lastfmRating").find("a");n.data("lastfmInfo",i),st(n)}function rt(t,i){var n=$("#lastfmRating").removeClass("loved notloved error loading"),e=n.find("a").off();null===t?n.addClass("loading"):"string"==typeof t?(n.addClass("error"),e.data("msg",t).click(i.getLastfmInfo),e.data("lastfmInfo","")):!0===t?(n.addClass("loved"),e.data("msg",Lt("lastfmUnlove")).click(i.unlove)):!1===t&&(n.addClass("notloved"),e.data("msg",Lt("lastfmLove")).click(i.love)),st(e)}function ct(i){rt(i,{getLastfmInfo:t.loadCurrentLastfmInfo,unlove:t.unloveTrack,love:t.loveTrack})}function dt(){null!==It.volume&&$("#volumeBarContainer").toggle()}function ut(i){var n=$("#quicklinks");n.empty();var e=$("<div>"),a=$("<div>");n.append(e,a);var l=t.getQuicklinks();l.forEach(function(i,n){$("<a tabindex='0' class='nav'>").attr("data-link",i).text(t.getTextForQuicklink(i)).appendTo(n<l.length/2?e:a)}),Ht(St.coverClickLink),qt(St.titleClickLink);var s=i&&i.searchPlaceholder?i.searchPlaceholder:Lt("searchPlaceholder");$("#navHead > input").attr("placeholder",s),pt()}function ft(t){var i=$("#favorites").empty();t.length?(t.forEach(function(t){var n=$("<div draggable='true'>");$("<img>").attr("src","img/cover.png").appendTo(n),$("<a tabindex='0' class='fav'>").data("fav",t).attr("title",Lt("delfavorite",t.title)).appendTo(n),$("<a tabindex='0' class='edit'>").attr("title",Lt("editfavorite",t.title)).appendTo(n),$("<a tabindex='0' class='nav'>").text(t.title).data("link",t.link).appendTo(n),i.append(n)}),i.append("<div class='lastdrop'>")):i.append("<div class='empty'>"),i.toggleClass("sortable",t.length>1)}function vt(i){t.setSongPosition(i.offsetX/$(this).width())}function gt(i){t.setVolume(i.offsetX/$(this).width())}function pt(){xt={},$("a[data-link]").each(function(){xt[$(this).data("link")]=!0})}var mt,ht,$t,kt=t.extractUrlParam("type",location.search)||"popup",yt=[],bt={},wt=!1,xt={},Ct={},Lt=chrome.i18n.getMessage,Tt=t.localSettings,St=t.settings,It=t.player,Pt=t.song,Rt=initGA(St,kt);Tt.favorites.forEach(function(t){Ct[t.link]=!0}),"popup"==kt?(t.popupOpened(),$("html").addClass("layout-normal")):St.w("layout",function(t,i){$("html").removeClass("layout-"+i).addClass("layout-"+t)},kt),St.w("hideRatings",n,kt),It.w("favicon",e,kt);var Ht=z.bind(window,"#coverContainer"),qt=z.bind(window,"#track, #nosong a:first-child"),Et={playlistsList:function(t,i){i.forEach(function(i){if(!(t.children().length>i.index)){var n=$("<div>");$("<img>").attr("src",i.cover||"img/cover.png").appendTo(n),n.append(K(i.titleLink,i.title));var e=$("<div>");$("<a tabindex='0' class='album nav'>").data("link",i.titleLink).text(i.title).attr("title",i.title).appendTo(e),i.subTitleLink?$("<a tabindex='0' class='nav'>").data("link",i.subTitleLink).text(i.subTitle).attr("title",i.subTitle).appendTo(e):i.subTitle&&$("<span>").text(i.subTitle).attr("title",i.subTitle).appendTo(e),n.append(e),t.append(n)}})},playlist:function(i,n,e,a,l){i.data("cluster",a);var s=!0,o=!0,r=0;e?(s=i.hasClass("noalbum"),o=i.hasClass("norating"),r=i.data("duration")):l.append("<span class='duration'></span>");var c;n.forEach(function(n){if(!(i.children().length>n.index)){var e=$("<div data-index='"+n.index+(n.current?"' class='current'>":"'>"));$("<img>").attr("src",n.cover||"img/cover.png").appendTo(e),$("<div class='rating r"+n.rating+"'>").html(ht).appendTo(e),n.rating>=0&&(o=!1);var a,l=$("<div class='info'>");a=Tt.lyrics?$("<a tabindex='0' class='nav' data-link='lyrics'>").data("options",{artist:n.artist,title:n.title}).attr("title",Lt("lyricsFor",n.title)):$("<span>").attr("title",n.title),a.text(n.title).appendTo(l),$("<span class='duration'>").text(n.duration).appendTo(l),r+=t.parseSeconds(n.duration),n.artistLink?$("<a tabindex='0' class='nav'>").data("link",n.artistLink).text(n.artist).attr("title",n.artist).appendTo(l):$("<span>").text(n.artist).attr("title",n.artist).appendTo(l);var d,u=n.albumLink==bt.link;n.albumLink&&!u?d=$("<a tabindex='0' class='album nav'>").data("link",n.albumLink):n.album&&(d=$("<span class='album'>")),d&&(d.text(n.album).attr("title",n.album).appendTo(l),u||(s=!1)),e.append(l),e.data("song",n),i.append(e),n.current&&(c=e[0])}}),i.toggleClass("noalbum",s),i.toggleClass("norating",o),i.data("duration",r),i.toggleClass("noduration",!r),r&&l.find("span.duration").text("("+t.toTimeString(r)+")"),c&&(f(i),c.scrollIntoView(!0))},albumContainers:function(t,i){i.forEach(function(i){if(!(t.children().length>i.index)){var n=$("<div>");$("<img>").attr("src",i.cover||"img/cover.png").appendTo(n),n.append(K(i.link,i.title)),$("<a tabindex='0' class='title nav'>").data("link",i.link).text(i.title).attr("title",i.title).appendTo(n),t.append(n)}})}};$(function(){$("html").addClass(kt),lt(),at(),$("#miniplayerlink").click(t.openMiniplayer).attr("title",Lt("openMiniplayer")),$("#feelingLucky").click(t.executeFeelingLucky).attr("title",Lt("feelingLucky")),$("#nosong").children("a:first-child").text(Lt("nothingPlaying")).end().children("a:last-child").click(t.openGoogleMusicTab).text(Lt("gotoGmusic")),$("#scrobblePosition").attr("title",Lt("scrobblePosition")),$("#timeBarHolder").click(vt),$("#quicklinksBtn").data("text",Lt("quicklinks")).attr("title",Lt("showQuicklinks")),$("#lastfmInfo").find(".userplaycount").html(Lt("lastfmInfo_userplaycount","<span></span>")).end().find(".playcount").html(Lt("lastfmInfo_playcount","<span></span>")).end().find(".listeners").html(Lt("lastfmInfo_listeners","<span></span>")),$("#lastfmUser").on("contextmenu",function(){return St.scrobble=!St.scrobble,!1}),$("#showfavorites").data("text",Lt("favorites")).attr("title",Lt("favorites")),nt(),Tt.w("lastfmSessionName",F,kt),Tt.w("lyrics",_,kt),Tt.w("lyricsFontSize",B,kt),Tt.w("quicklinks",ut,kt),Tt.w("favorites",ft,kt),St.w("scrobble",S,kt),St.w("showLastfmInfo",I,kt),St.w("color",P,kt),St.w("mpBgColor",R,kt),St.w("mpTextColor",H,kt),St.al("mpShowTitle",g,kt),St.al("coverClickLink",Ht,kt),St.al("titleClickLink",qt,kt),St.w("hideSearchfield",q,kt),St.w("hideLucky",E,kt),St.al("saveLastPosition",G,kt),St.w("hideFavorites",A,kt),St.w("starRatingMode",w,kt),It.w("repeat",a,kt),It.w("shuffle",s,kt),It.w("rewind",o,kt),It.w("forward",r,kt),It.w("playing",c,kt),It.w("volume",U,kt),It.w("connected",X,kt),It.al("navigationList",V,kt),It.al("listrating",N,kt),Pt.w("info",p,kt),Pt.w("positionSec",k,kt),Pt.w("rating",C,kt),Pt.w("scrobbleTime",L,kt),Pt.w("loved",ct,kt),Pt.w("lastfmInfo",ot,kt),Pt.w("scrobbled",T,kt),"hbar"!=St.layout&&Y(Tt.miniplayerSizing[St.layout]),"miniplayer"!=kt&&"toast"!=kt||M(),"toast"==kt&&St.toastDuration>0&&O(),$(window).on("unload",function(){Tt.ral(kt),St.ral(kt),It.ral(kt),Pt.ral(kt)})})});