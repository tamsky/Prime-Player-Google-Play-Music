/*!
 * A JavaScript implementation of the RSA Data Security, Inc. MD5 Message
 * Digest Algorithm, as defined in RFC 1321.
 * Version 2.2 Copyright (C) Paul Johnston 1999 - 2009
 * Other contributors: Greg Holt, Andrew Kepert, Ydnar, Lostinet
 * @license BSD License
 * See http://pajhome.org.uk/crypt/md5 for more info.
 */
function hex_md5(e){return rstr2hex(rstr_md5(str2rstr_utf8(e)))}function hex_hmac_md5(e,t){return rstr2hex(rstr_hmac_md5(str2rstr_utf8(e),str2rstr_utf8(t)))}function md5_vm_test(){return"900150983cd24fb0d6963f7d28e17f72"==hex_md5("abc").toLowerCase()}function rstr_md5(e){return binl2rstr(binl_md5(rstr2binl(e),8*e.length))}function rstr_hmac_md5(e,t){var n=rstr2binl(e);n.length>16&&(n=binl_md5(n,8*e.length));for(var i=Array(16),o=Array(16),r=0;r<16;r++)i[r]=909522486^n[r],o[r]=1549556828^n[r];var a=binl_md5(i.concat(rstr2binl(t)),512+8*t.length);return binl2rstr(binl_md5(o.concat(a),640))}function rstr2hex(e){for(var t,n=hexcase?"0123456789ABCDEF":"0123456789abcdef",i="",o=0;o<e.length;o++)t=e.charCodeAt(o),i+=n.charAt(t>>>4&15)+n.charAt(15&t);return i}function str2rstr_utf8(e){for(var t,n,i="",o=-1;++o<e.length;)t=e.charCodeAt(o),n=o+1<e.length?e.charCodeAt(o+1):0,55296<=t&&t<=56319&&56320<=n&&n<=57343&&(t=65536+((1023&t)<<10)+(1023&n),o++),t<=127?i+=String.fromCharCode(t):t<=2047?i+=String.fromCharCode(192|t>>>6&31,128|63&t):t<=65535?i+=String.fromCharCode(224|t>>>12&15,128|t>>>6&63,128|63&t):t<=2097151&&(i+=String.fromCharCode(240|t>>>18&7,128|t>>>12&63,128|t>>>6&63,128|63&t));return i}function rstr2binl(e){for(var t=Array(e.length>>2),n=0;n<t.length;n++)t[n]=0;for(var n=0;n<8*e.length;n+=8)t[n>>5]|=(255&e.charCodeAt(n/8))<<n%32;return t}function binl2rstr(e){for(var t="",n=0;n<32*e.length;n+=8)t+=String.fromCharCode(e[n>>5]>>>n%32&255);return t}function binl_md5(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var n=1732584193,i=-271733879,o=-1732584194,r=271733878,a=0;a<e.length;a+=16){var s=n,c=i,l=o,u=r;n=md5_ff(n,i,o,r,e[a+0],7,-680876936),r=md5_ff(r,n,i,o,e[a+1],12,-389564586),o=md5_ff(o,r,n,i,e[a+2],17,606105819),i=md5_ff(i,o,r,n,e[a+3],22,-1044525330),n=md5_ff(n,i,o,r,e[a+4],7,-176418897),r=md5_ff(r,n,i,o,e[a+5],12,1200080426),o=md5_ff(o,r,n,i,e[a+6],17,-1473231341),i=md5_ff(i,o,r,n,e[a+7],22,-45705983),n=md5_ff(n,i,o,r,e[a+8],7,1770035416),r=md5_ff(r,n,i,o,e[a+9],12,-1958414417),o=md5_ff(o,r,n,i,e[a+10],17,-42063),i=md5_ff(i,o,r,n,e[a+11],22,-1990404162),n=md5_ff(n,i,o,r,e[a+12],7,1804603682),r=md5_ff(r,n,i,o,e[a+13],12,-40341101),o=md5_ff(o,r,n,i,e[a+14],17,-1502002290),i=md5_ff(i,o,r,n,e[a+15],22,1236535329),n=md5_gg(n,i,o,r,e[a+1],5,-165796510),r=md5_gg(r,n,i,o,e[a+6],9,-1069501632),o=md5_gg(o,r,n,i,e[a+11],14,643717713),i=md5_gg(i,o,r,n,e[a+0],20,-373897302),n=md5_gg(n,i,o,r,e[a+5],5,-701558691),r=md5_gg(r,n,i,o,e[a+10],9,38016083),o=md5_gg(o,r,n,i,e[a+15],14,-660478335),i=md5_gg(i,o,r,n,e[a+4],20,-405537848),n=md5_gg(n,i,o,r,e[a+9],5,568446438),r=md5_gg(r,n,i,o,e[a+14],9,-1019803690),o=md5_gg(o,r,n,i,e[a+3],14,-187363961),i=md5_gg(i,o,r,n,e[a+8],20,1163531501),n=md5_gg(n,i,o,r,e[a+13],5,-1444681467),r=md5_gg(r,n,i,o,e[a+2],9,-51403784),o=md5_gg(o,r,n,i,e[a+7],14,1735328473),i=md5_gg(i,o,r,n,e[a+12],20,-1926607734),n=md5_hh(n,i,o,r,e[a+5],4,-378558),r=md5_hh(r,n,i,o,e[a+8],11,-2022574463),o=md5_hh(o,r,n,i,e[a+11],16,1839030562),i=md5_hh(i,o,r,n,e[a+14],23,-35309556),n=md5_hh(n,i,o,r,e[a+1],4,-1530992060),r=md5_hh(r,n,i,o,e[a+4],11,1272893353),o=md5_hh(o,r,n,i,e[a+7],16,-155497632),i=md5_hh(i,o,r,n,e[a+10],23,-1094730640),n=md5_hh(n,i,o,r,e[a+13],4,681279174),r=md5_hh(r,n,i,o,e[a+0],11,-358537222),o=md5_hh(o,r,n,i,e[a+3],16,-722521979),i=md5_hh(i,o,r,n,e[a+6],23,76029189),n=md5_hh(n,i,o,r,e[a+9],4,-640364487),r=md5_hh(r,n,i,o,e[a+12],11,-421815835),o=md5_hh(o,r,n,i,e[a+15],16,530742520),i=md5_hh(i,o,r,n,e[a+2],23,-995338651),n=md5_ii(n,i,o,r,e[a+0],6,-198630844),r=md5_ii(r,n,i,o,e[a+7],10,1126891415),o=md5_ii(o,r,n,i,e[a+14],15,-1416354905),i=md5_ii(i,o,r,n,e[a+5],21,-57434055),n=md5_ii(n,i,o,r,e[a+12],6,1700485571),r=md5_ii(r,n,i,o,e[a+3],10,-1894986606),o=md5_ii(o,r,n,i,e[a+10],15,-1051523),i=md5_ii(i,o,r,n,e[a+1],21,-2054922799),n=md5_ii(n,i,o,r,e[a+8],6,1873313359),r=md5_ii(r,n,i,o,e[a+15],10,-30611744),o=md5_ii(o,r,n,i,e[a+6],15,-1560198380),i=md5_ii(i,o,r,n,e[a+13],21,1309151649),n=md5_ii(n,i,o,r,e[a+4],6,-145523070),r=md5_ii(r,n,i,o,e[a+11],10,-1120210379),o=md5_ii(o,r,n,i,e[a+2],15,718787259),i=md5_ii(i,o,r,n,e[a+9],21,-343485551),n=safe_add(n,s),i=safe_add(i,c),o=safe_add(o,l),r=safe_add(r,u)}return Array(n,i,o,r)}function md5_cmn(e,t,n,i,o,r){return safe_add(bit_rol(safe_add(safe_add(t,e),safe_add(i,r)),o),n)}function md5_ff(e,t,n,i,o,r,a){return md5_cmn(t&n|~t&i,e,t,o,r,a)}function md5_gg(e,t,n,i,o,r,a){return md5_cmn(t&i|n&~i,e,t,o,r,a)}function md5_hh(e,t,n,i,o,r,a){return md5_cmn(t^n^i,e,t,o,r,a)}function md5_ii(e,t,n,i,o,r,a){return md5_cmn(n^(t|~i),e,t,o,r,a)}function safe_add(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function bit_rol(e,t){return e<<t|e>>>32-t}/**
 * @license Copyright (c) 2008-2010, Felix Bruns <felixbruns@web.de>
 * @author Sven Ackermann (svenrecknagel@gmail.com)
 */
function LastFM(e,t){this.session={},this.sessionTimeoutCallback=null,this.unavailableMessage=null;var n=this,i=function(e,t,i){e.format="json",$.ajax({type:i,url:"https://ws.audioscrobbler.com/2.0/",data:e,timeout:1e4}).done(function(e){e.error?($.isFunction(t.error)&&t.error(e.error,e.message),9==e.error&&$.isFunction(n.sessionTimeoutCallback)&&n.sessionTimeoutCallback()):t.success(e)}).fail(function(e,i,o){if($.isFunction(t.error)){var r=i;e.status&&(r+=" "+e.status),o&&o!=i&&(r+=" "+o),n.unavailableMessage&&(r=n.unavailableMessage+" ("+r+")"),t.error(-1,r)}})},o=function(t,n,o,r){n=n||{},o=o||{},r=r||"GET",n.method=t,n.api_key=e,i(n,o,r)},r={getApiSignature:function(e){var n=[],i="";for(var o in e)n.push(o);n.sort();for(var r in n){var a=n[r];i+=a+e[a]}return i+=t,hex_md5(i)}},a=function(t,o,a,s){o=o||{},a=a||{},s=s||"GET",o.method=t,o.api_key=e,n.session.key&&(o.sk=n.session.key),o.api_sig=r.getApiSignature(o),i(o,a,s)};this.auth={getSession:function(e,t){a("auth.getSession",e,t)}},this.track={getInfo:function(e,t){o("track.getInfo",e,t)},love:function(e,t){a("track.love",e,t,"POST")},scrobble:function(e,t){a("track.scrobble",e,t,"POST")},unlove:function(e,t){a("track.unlove",e,t,"POST")},updateNowPlaying:function(e,t){a("track.updateNowPlaying",e,t,"POST")}},this.getLoginUrl=function(t){return"http://www.last.fm/api/auth?api_key="+e+"&cb="+t}}/**
 * @author Sven Ackermann (svenrecknagel@gmail.com)
 * @license BSD license
 */
function Bean(e,t){function n(t){clearTimeout(s),v.get(null,function(i){var o=chrome.runtime.lastError;if(o)s=setTimeout(function(){n(t)},3e4);else{for(var r in i)e.hasOwnProperty(r)&&(p[r]=i[r]);$.isFunction(t)&&t()}})}function i(){clearTimeout(c),c=setTimeout(function(){v.set(l,function(){var e=chrome.runtime.lastError;e&&i()})},1e4)}function o(e){return e&&"object"==typeof e?$.isArray(e)?e.slice():$.extend(!0,{},e):e}function r(e,t){var n=o(t);if(!d||void 0===localStorage[e])return n;var i=localStorage[e],r=i.substr(0,1);switch(i=i.substr(1),r){case"o":return"null"==i?null:"["==i[0]?JSON.parse(i):$.extend(n,JSON.parse(i));case"b":return"true"==i;case"n":return parseFloat(i);default:return i}}function a(e,t){return e===t&&("object"!=typeof e||null===e)}var s,c,l={},u={},f={},d=t||!1,m={},g=!1,p=this,v=chrome.storage.sync;this.al=function(e,t,n){var i=t._wrappedCallback;i||(i=function(){try{return t.apply(this,arguments)}catch(e){}},t._wrappedCallback=i),e.split(/\s+/).forEach(function(e){u[e].has(i)||(n&&(f[n]||(f[n]=[]),f[n].push({l:t,p:e})),u[e].add(i))})},this.rl=function(e,t){var n=t._wrappedCallback;n&&e.split(/\s+/).forEach(function(e){u[e].remove(n)})},this.arl=function(e,t,n,i){n?p.al(e,t,i):p.rl(e,t)},this.ral=function(e){var t=f[e];t&&(delete f[e],t.forEach(function(e){p.rl(e.p,e.l)}))},this.w=function(e,t,n){e.indexOf(" ")<0?t(l[e],l[e],e):t(),p.al(e,t,n)},this.wrl=function(e,t,n,i){n?p.w(e,t,i):p.rl(e,t)},this.setEqualsFn=function(e,t){m[e]=t},this.setSyncStorage=function(e,t){e?n(t):(clearTimeout(s),clearTimeout(c)),g=e},this.reset=function(){for(var t in e)p[t]=o(e[t]),d&&localStorage.removeItem(t);g&&(clearTimeout(c),v.clear())},this.getAll=function(){return l},this.importProperties=function(e){var t=[];for(var n in e)void 0!==u[n]?p[n]=e[n]:t.push(n);return t};for(var h in e)!function(e,t){l[e]=r(e,t),u[e]=$.Callbacks(),Object.defineProperty(p,e,{get:function(){return l[e]},set:function(n){var o=l[e],r=m[e]||a;if(!r(n,o)){if(d)if(void 0===n||r(n,t))localStorage.removeItem(e);else{var s=typeof n;if("function"==s)throw"cannot store a function in localstorage";localStorage[e]=s.substr(0,1)+("object"==s?JSON.stringify(n):n)}l[e]=n,g&&i(),u[e].fire(n,o,e)}},enumerable:!0})}(h,e[h])}/**
 * @author Sven Ackermann (svenrecknagel@gmail.com)
 * @license BSD license
 */
function initLyricsProviders(e){function t(e){var t=$(e.replace(/<img[^>]*>/gi,""));return t=t.not("script"),t.find("script").remove(),t}function n(e){return e.indexOf("(")>0&&(e=e.replace(/\(.*\)/,"").trim()),fixForUri(e)}function i(t,n,i,a){function s(n){e.event("Lyrics-"+t,n)}function c(){s("Error-noURL")}function l(){s("Error-noPermission")}var u={origins:[n+"/*"]},f={file:"js/cs-"+t+".js"},d=null;this.checkPermission=function(e){if(null!==d)return e(d);o.contains(u,function(t){d=t,e(t)})},this.checkPermission($.noop),this.getUrl=function(){return n.substr(n.indexOf("://")+3)},this.getHomepage=function(){return n},this.requestPermission=function(e){chrome.permissions.request(u,function(t){d=t,e(t)})},this.errorGetSearch=function(e,t){s("Error-GET-Search"),e({error:!0,searchSrc:t})},this.noResult=function(e,t){s("NoResult"),e({noresults:!0,searchSrc:t})},this.noLyrics=function(e,t,n){s("NoLyrics"),e({noresults:!0,src:t,searchSrc:n})},this.errorGetResult=function(e,t,n){s("Error-GET-Result"),e({error:!0,src:t,searchSrc:n})},this.foundLyrics=function(e,t,n,i,o,r){s("OK"),e({title:t,lyrics:n,credits:i&&i.length?i:null,src:o,searchSrc:r})},this.fetchLyrics=function(e,t){if(!d)return l(),void t({error:!0});var n=a.call(this,e);n?i(t,n,this):(c(),t({error:!0}))},this.openLyrics=function(e,t,n,i){function o(e){function i(r,a){r!=e.id||o||"complete"!=a.status||(o=!0,t.onUpdated.removeListener(i),t.executeScript(r,f,function(e){n(e[0],r)}))}var o=!1;t.onUpdated.addListener(i),i(e.id,{status:e.status})}if(!d)return l(),void n(!1,i);var r=a.call(this,e);r?i?(t.update(i,{url:r},o),s("Update")):(t.create({url:r},o),s("Open")):(c(),n(!1,i))},r[t]=this,r.available.push(t)}var o=chrome.permissions,r={available:[]};return new i("musixmatch","https://www.musixmatch.com",function(e,n,i){$.get(n).done(function(o){var r=t(o).find(".media-card-body").filter(function(){return!$(".add-lyrics-button",this).length}),a=r.find("a.title").attr("href");a?(a=i.getHomepage()+a,$.get(a).done(function(o){var r=t(o),s=r.find(".mxm-lyrics__content"),c=s.text().trim();if(c.length){s=$("<div>").html(c.replace(/\n/g,"<br>"));var l=$.trim(r.find(".mxm-lyrics__copyright").text());l=l?$("<div>").html(l):null;var u=$.trim(r.find(".mxm-track-title__track").first().text()),f=$.trim(r.find(".mxm-track-title__artist").first().text());f&&(u=f+" - "+u),i.foundLyrics(e,$("<h1>").text(u),s,l,a,n)}else i.noLyrics(e,a,n)}).fail(function(){i.errorGetResult(e,a,n)})):i.noResult(e,n)}).fail(function(){i.errorGetSearch(e,n)})},function(e){return e.artist&&e.title?this.getHomepage()+"/search/"+fixForUri(e.artist)+"+"+n(e.title)+"/tracks":null}),new i("lyricswikia","http://lyrics.wikia.com",function(e,n,i){$.getJSON(n,"fmt=realjson").done(function(o){o.url&&o.lyrics&&"Not found"!=$.trim(o.lyrics)?$.get(o.url).done(function(r){var a=t(r),s=a.find(".lyricbox");if(s.text().trim().length){var c=a.find(".song-credit-box");if(c.length){var l=$("<p>");c.find("tr").each(function(){l.append($(this).text(),"<br>")}),l.children().length&&(l.find("br").last().remove(),c=l)}i.foundLyrics(e,a.find("#WikiaPageHeader h1"),s,c,o.url,n)}else i.noLyrics(e,o.url,n)}).fail(function(){i.errorGetResult(e,o.url,n)}):i.noResult(e,n)}).fail(function(){i.errorGetSearch(e,n)})},function(e){return e.artist&&e.title?this.getHomepage()+"/api.php?func=getSong&artist="+fixForUri(e.artist)+"&song="+n(e.title):null}),new i("songlyrics","http://www.songlyrics.com",function(e,n,i){$.get(n).done(function(o){var r=t(o).find(".serpresult > a").attr("href");r?$.get(r).done(function(o){var a=t(o),s=a.find("#songLyricsDiv"),c=s.text().trim();c.length&&0!==c.indexOf("We do not have the lyrics for")?i.foundLyrics(e,a.find(".pagetitle h1"),s,a.find(".albuminfo > li > p"),r,n):i.noLyrics(e,r,n)}).fail(function(){i.errorGetResult(e,r,n)}):i.noResult(e,n)}).fail(function(){i.errorGetSearch(e,n)})},function(e){var t="",i="",o="";e.artist&&(t=fixForUri(e.artist),o=t),e.title&&(i=n(e.title),o=(o?o+"+":"")+i);var r=null;return o&&(r=this.getHomepage()+"/index.php?section=search&searchW="+o+"&submit=Search",t&&(r+="&searchIn1=artist"),i&&(r+="&searchIn3=song")),r}),r}function fixForUri(e){return encodeURIComponent($.trim(e)).replace(/(%20)+/g,"+")}var hexcase=0;Bean.objectEquals=function(e,t){if(e===t)return!0;if(!e||!t)return!1;var n=Object.getOwnPropertyNames(e);return n.length==Object.getOwnPropertyNames(t).length&&n.every(function(n){return e[n]===t[n]})};/**
 * @author Sven Ackermann (svenrecknagel@gmail.com)
 * @license BSD license
 */
var previousVersion=localStorage.previousVersion;!function(e){function t(){Rt.lastError&&$.noop()}function n(e){return"string"!=typeof e?0:e.split(":").reverse().reduceRight(function(e,t,n){return parseInt(t)*Math.pow(60,n)+e},0)||0}function i(e,t){return e==t||!(!e||!t||null!==e.duration&&null!==t.duration&&e.duration!=t.duration||e.playlist&&t.playlist&&e.playlist==t.playlist&&(e.cluster!=t.cluster||e.index!=t.index)||e.title!=t.title||e.artist!=t.artist||e.album!=t.album)}function o(e,t){e=e.split("."),t=t.split(".");for(var n=0;n<e.length;n++){if(t.length<=n)return 1;var i=parseInt(e[n]),o=parseInt(t[n]);if(i!=o)return i-o}return e.length-t.length}function r(e){return null!=previousVersion&&o(previousVersion,e)<0}function a(){var e=["now","artists","albums","genres","wms","wmp","ap/queue","ap/auto-playlist-thumbs-up","ap/auto-playlist-recent","ap/auto-playlist-promo"];return Qt.quicklinks&&Qt.quicklinks.wtc&&e.push("wtc","wnr"),e}function s(e,t){return e==t||!Xt.starRatingMode&&(2==e&&1==t||4==e&&5==t)}function c(e){if(!Xt.saveLastPosition)return!1;Ut.get(null,function(t){if(t.lastSong){var i={info:t.lastSong,position:t.lastPosition,positionSec:n(t.lastPosition),rating:t.rating,scrobbled:t.scrobbled||!1,scrobbleTime:t.scrobbleTime||-1,ff:t.ff||!1,timestamp:t.timestamp||null};e(i)}})}function l(e){var t;return e&&(t=Qt.quicklinks[e]),t||Et("quicklink_"+e.replace(/-/g,"_").replace(/\//g,"_"))}function u(){Rt.openOptionsPage()}function f(e){return"sr/"+fixForUri(e)}function d(){return[Qt.lyrics.toString(),p().toString(),Xt.toast.toString(),Xt.layout]}function m(){return[Xt.scrobblePercent.toString(),Xt.toastDuration.toString()]}function g(){tn.setDimensions(d())}function p(){return Xt.scrobble&&!!Qt.lastfmSessionKey}function v(e){if(!Xt.lastFmArtistFilter||!e.artist)return!1;var t=e.artist.trim().toLowerCase();return Xt.lastFmArtistFilter.split(",").some(function(e){return t==e.trim().toLowerCase()})}function h(){var e=en.getLoginUrl(Nt("lastfmCallback.html"));xt.create({url:e},function(e){Mt=e.id}),tn.event(qt,"AuthorizeStarted")}function b(){tn.event(qt,"Logout"),en.session={},Qt.lastfmSessionKey=null,Qt.lastfmSessionName=null,Yt.loved=null}function y(e,t){if(e){if(v(e))return void t(Et("songIgnored"),null);var n={artist:e.artist,track:e.title};Qt.lastfmSessionName&&(n.username=Qt.lastfmSessionName),en.track.getInfo(n,{success:function(e){var i=null,o=null;e.track&&(o={listeners:e.track.listeners||0,playcount:e.track.playcount||0,userplaycount:e.track.userplaycount||0,url:e.track.url,artistUrl:e.track.artist&&e.track.artist.url,albumUrl:e.track.album&&e.track.album.url},n.username&&(i=1==e.track.userloved)),t(i,o)},error:function(e,n){t(Et("lastfmError")+n,null),tn.event(qt,"getInfoError-"+e)}})}else t(null,null)}function w(e,t,n){if(Qt.lastfmSessionKey&&t){var i=e?"love":"unlove";en.track[i]({artist:t.artist,track:t.title},{success:function(){n(e)},error:function(e,t){n(t),tn.event(qt,i+"Error-"+e)}})}}function k(e){Yt.loved=null;var t=Yt.info;e(t,function(e){t==Yt.info&&(Yt.loved=e)})}function S(e){!0!==Yt.loved&&(k(on),e&&Xt.linkRatings&&0===Yt.rating&&O("rate",{rating:5}))}function L(e){!0===Yt.loved&&(k(rn),e&&Xt.linkRatings&&Xt.linkRatingsReset&&Yt.rating>=Xt.linkRatingsMin&&O("rate",{rating:Yt.rating}))}function _(){Yt.lastfmInfo=null,Yt.loved=null;var e=Yt.info;y(e,function(t,n){e==Yt.info&&(Yt.lastfmInfo=n,Yt.loved=t,Xt.linkRatings&&Xt.linkRatingsAuto&&(!0===t&&0===Yt.rating?O("rate",{rating:5}):!1===t&&(Yt.rating>=Xt.linkRatingsMin||!Xt.starRatingMode&&Yt.rating>=4)&&S()))})}function C(){if(!Yt.scrobbled)if(!(Yt.info&&Yt.info.durationSec>0&&p())||v(Yt.info)||Yt.ff&&Xt.disableScrobbleOnFf||Xt.scrobbleMaxDuration>0&&Yt.info.durationSec>60*Xt.scrobbleMaxDuration)Yt.scrobbleTime=-1;else{var e=Yt.info.durationSec*Xt.scrobblePercent/100;Xt.scrobbleTime>0&&e>Xt.scrobbleTime&&(e=Xt.scrobbleTime),e=Math.min(Yt.info.durationSec-3,Math.max(3,e)),Yt.scrobbleTime=e}}function I(e){var t=localStorage.scrobbleCache;for(t=t?JSON.parse(t):{},t.user!=Qt.lastfmSessionName&&(t.songs=[],t.user=Qt.lastfmSessionName);t.songs.length>=50;)t.songs.shift();t.songs.push(e),localStorage.scrobbleCache=JSON.stringify(t)}function P(e){return 16==e||11==e||9==e||-1==e}function A(){var e=localStorage.scrobbleCache;if(e){if(e=JSON.parse(e),e.user!=Qt.lastfmSessionName)return void localStorage.removeItem("scrobbleCache");var t={},n=0;e.songs.forEach(function(e){if(!v(e)){for(var i in e)t[i+"["+n+"]"]=e[i];n++}}),en.track.scrobble(t,{success:function(){localStorage.removeItem("scrobbleCache"),tn.event(qt,"ScrobbleCachedOK")},error:function(e){P(e)||localStorage.removeItem("scrobbleCache"),tn.event(qt,"ScrobbleCachedError-"+e)}})}}function M(){var e={artist:Yt.info.artist,duration:Yt.info.durationSec,track:Yt.info.title},t=Yt.info.album;t&&(e.album=t);var n=Yt.info.albumArtist;return n&&n!=e.artist&&(e.albumArtist=n),e}function R(){var e=M();e.timestamp=Yt.timestamp,Yt.info.albumArtist&&(e.albumArtist=Yt.info.albumArtist);var t=$.extend({},e);en.track.scrobble(e,{success:function(){tn.event(qt,"ScrobbleOK"),A()},error:function(e){P(e)&&I(t),tn.event(qt,"ScrobbleError-"+e)}})}function x(){v(Yt.info)||en.track.updateNowPlaying(M(),{success:function(){tn.event(qt,"NowPlayingOK")},error:function(e){tn.event(qt,"NowPlayingError-"+e)}})}function T(e){St&&St.postMessage(e)}function O(e,t){T({type:"execute",command:e,options:t||{}})}function U(e){O("setVolume",{percent:e})}function E(e,t){Xt.autoActivateGm?xt.get(Lt,function(n){Tt.get(n.windowId,function(i){function o(i){function o(n){e(),Xt.autoRestoreGm&&(t?t(n):setTimeout(n,250))}n.active?o(i):xt.query({active:!0,windowId:n.windowId},function(e){xt.update(Lt,{active:!0},function(){o(e[0]?function(){xt.update(e[0].id,{active:!0},i)}:i)})})}"minimized"==i.state?Tt.update(i.id,{state:"maximized"},function(){o(function(){Tt.update(i.id,{state:"minimized"})})}):o($.noop)})}):e()}function N(e){O("setPosition",{percent:e})}function F(e){Yt.rating<0||(Xt.linkRatings&&(e>=Xt.linkRatingsMin&&!s(Yt.rating,e)?S():Xt.linkRatingsReset&&L()),O("rate",{rating:e}))}function D(){T({type:"lyricsState",enabled:Qt.lyrics&&Xt.lyricsInGpm,fontSize:Qt.lyricsFontSize,width:Qt.lyricsWidth,opacity:Qt.lyricsOpacity,autoReload:Xt.lyricsAutoReload})}function G(){T({type:"starRatingMode",value:Xt.starRatingMode})}function q(){an&&(Zt.connected?(T({type:"getNavigationList",link:an,omitUnknownAlbums:"albums"==an&&Xt.omitUnknownAlbums}),an=null):Me(an,!1,!0))}function B(e){an=e,q()}function z(e,t){T({type:"selectLink",link:e}),Me(e,!0,!1,t)}function j(e,t){sn&&(Zt.connected?(T({type:"startPlaylist",link:sn}),sn=null):Me(sn,t,!0,e))}function K(e,t,n){sn=e,j(t,n)}function V(){cn&&(Zt.connected?(T({type:"feelingLucky"}),cn=!1):Me(null,!1,!0))}function W(){cn=!0,V()}function J(){if(Ct)if(Zt.connected){var e=Ct.info;E(T.bind(window,{type:"resumeLastSong",albumLink:e.albumLink,artist:e.artist,title:e.title,duration:e.duration,position:Ct.positionSec/e.durationSec}),function(t){function n(o){o&&(Yt.rl("info",n),i(o,e)&&setTimeout(t,1500))}Yt.w("info",n)})}else Me(null,!1,!0)}function H(e){Ct=e,J()}function Q(e){O("playPause",{resume:e})}function X(){O("nextSong")}function Y(e){function t(i){var o=Qt.lyricsProviders;nn[o[n]].openLyrics(e,xt,function(e,i){!e&&Xt.lyricsAutoNext&&o[++n]&&t(i)},i)}if(!e){if(!Yt.info)return;e={artist:Yt.info.artist,title:Yt.info.title}}var n=0;t()}function Z(e,t,n){nn[t].fetchLyrics(e,function(e){n(t,e)})}function ee(e,t){function n(){var o=Qt.lyricsProviders;Z(e,o[i],function(e,r){(r.error||r.noresults)&&Xt.lyricsAutoNext&&o[++i]?n():t(o.slice(i+1),e,r)})}var i=0;n()}function te(e,t,n){Qt.notificationsEnabled&&$t.update(e,t,n||$.noop)}function ne(e,t){Qt.notificationsEnabled&&$t.clear(e,t||$.noop)}function ie(e,t,n){ln[t][e].push(n)}function oe(e,t,n){t.type=t.type||"basic",t.iconUrl=t.iconUrl||"img/icon-128x128.png",t.appIconMaskUrl="img/icon-alpha.png",Qt.notificationsEnabled&&$t.create(e,t,function(e){ln[e]={click:[],btnClick:[],close:[]},n(e),ie("close",e,function(){delete ln[e]})})}function re(e,t,n){var i=ln[t];i&&i[e]&&i[e].forEach(function(e){e(n)})}function ae(){$t.onClicked.hasListener(un)||$t.onClicked.addListener(un),$t.onButtonClicked.hasListener(fn)||$t.onButtonClicked.addListener(fn),$t.onClosed.hasListener(dn)||$t.onClosed.addListener(dn)}function se(e){Qt.notificationsEnabled="granted"==e}function ce(e){return!!(Xt.showProgress&&mn&&Yt.info&&(e||Math.abs(Yt.positionSec-vn)>2))&&(vn=Yt.positionSec,e?gn=mn.getImageData(0,0,38,38):mn.putImageData(gn,0,0),vn&&(mn.strokeStyle=Zt.playing?Xt.showProgressColor:Xt.showProgressColorPaused,mn.globalAlpha=.5,mn.lineWidth=6,mn.beginPath(),mn.arc(18,19,14,1.5*Math.PI,(2*vn/Yt.info.durationSec-.5)*Math.PI),mn.stroke(),mn.globalAlpha=1),!0)}function le(e,t,n,i){function o(){var e=i?ct(i):t.shift();e?a.src=Nt(e+".png"):n(r)}var r=$("<canvas width='38' height='38'/>")[0].getContext("2d"),a=new Image,s=!1,c=gt(i);a.onload=function(){s?i?(i=null,r.globalAlpha=c?1:.5,r.drawImage(a,0,0,38,38),r.globalAlpha=1):r.drawImage(a,0,0):(r.globalAlpha=c||Xt.showProgress&&Yt.info?.5:1,r.drawImage(a,0,0),r.globalAlpha=1,s=!0),o()},a.src=Nt(e)}function ue(){mn&&Ot.setIcon({imageData:{38:mn.getImageData(0,0,38,38)}})}function fe(){var e,t="img/icon/",n=t+Xt.iconStyle+"/",i=Et("extTitle"),o=[];Ot.setBadgeText({text:""}),Jt?(n="img/icon/updated",i+=" - "+Et("browserActionTitle_"+Jt)):Zt.connected?(n+="connected",Yt.info?(i=Yt.info.artist+" - "+Yt.info.title,Yt.scrobbled&&Xt.showScrobbledIndicator&&(o.push("img/icon/scrobbled"),i+=" ("+Et("browserActionTitle_scrobbled")+")"),!0===Yt.loved&&Xt.showLovedIndicator&&o.push("img/icon/loved"),Yt.rating&&Yt.rating>0&&Xt.showRatingIndicator&&(Xt.starRatingMode?Ot.setBadgeText({text:""+Yt.rating}):Yt.rating>3?o.push("img/icon/thumbsUp"):Yt.rating<3&&o.push("img/icon/thumbsDown")),Xt.showPlayingIndicator&&(Zt.playing?(o.push("img/icon/playing"),i=Et("browserActionTitle_playing")+": "+i):(o.push("img/icon/paused"),i=Et("browserActionTitle_paused")+": "+i))):i+=" - "+Et("browserActionTitle_connected"),e=Xt.iconClickAction0):(n+="notconnected",Ht?(Ot.setBadgeText({text:"..."}),i+=" - "+Et("browserActionTitle_connecting")):e=ut()),n+=".png",gt(e)&&(i+=" - "+st(e)),le(n,o,function(e){mn=e,ce(!0),ue()},Xt.iconShowAction?e:null),o.length?le(n,o.concat(),function(e){Zt.favicon=e.canvas.toDataURL()}):Zt.favicon=n,Ot.setTitle({title:i})}function de(){clearTimeout(pn),pn=setTimeout(fe,100)}function me(e){Wt.some(function(t,n){if(e==t)return Wt.splice(n,1),!0})}function ge(e){St=e,Lt=e.sender.tab.id,e.onMessage.addListener(be),e.onDisconnect.addListener(he),Ht||(Ht=!0,et(),de(),Be()),Pt=null,e.postMessage({type:"connected"})}function pe(e){var t=e.sender.tab.id;return!(!St||t!=St.sender.tab.id)||Wt.some(function(e){return t==e.sender.tab.id})}function ve(e){if("googlemusic"!=e.name)throw"invalid port: "+e.name;pe(e)?e.postMessage({type:"alreadyConnected"}):St?(Wt.push(e),e.onDisconnect.addListener(me)):ge(e)}function he(){for(St=null,Lt=null,Ht=!1,et(),Yt.reset(),Zt.reset(),de(),Be();Wt.length>0;){var e=Wt.shift();try{e.onDisconnect.removeListener(me),ge(e);break}catch(e){}}}function be(e){function t(e,t,n){t.lyrics&&(t.lyrics=t.lyrics.html()),t.credits&&(t.credits=t.credits.html()),t.title&&(t.title=t.title.text().trim()),T({type:"lyrics",result:t,providers:n,srcUrl:nn[e].getUrl()})}var n=e.value,o=e.type;if(0===o.indexOf("song-"))"song-position"!=o||n||(n="0:00"),Yt[o.substring(5)]=n;else if(0===o.indexOf("player-"))Zt[o.substring(7)]=n;else if("connected"==o)Ht=!1,Zt.connected=!0,de(),Be(),Qt.quicklinks=n.quicklinks,et();else if("loadLyrics"==o){if(!Yt.info)return;n?Z(Yt.info,n,t):ee(Yt.info,function(e,n,i){var o=[];e.forEach(function(e){o.push({provider:e,url:nn[e].getUrl()})}),t(n,i,o)})}else if("rated"==o){if(Xt.linkRatings&&Xt.linkRatingsGpm){var r=i(Yt.info,n.song);n.rating>=Xt.linkRatingsMin?r?S():on(n.song,$.noop):n.rating>=0&&Xt.linkRatingsReset&&(r?L():rn(n.song,$.noop))}}else"needActiveTab"==o?E($.noop,function(e){bn.restore=e,bn.id=n}):"restoreActiveTab"==o&&bn.id==n&&(bn.id=null,bn.restore())}function ye(e){if(!e)return null;switch(e){case"loveUnloveSong":if(!Qt.lastfmSessionKey)return null;break;case"toggleRepeat":if(!Zt.repeat)return null;break;case"toggleShuffle":if(!Zt.shuffle)return null;break;case"rate-2":case"rate-3":case"rate-4":if(!Xt.starRatingMode)return null}return{title:st(e),iconUrl:ct(e)+".png"}}function we(){function e(){if(Vt){var e=$("<canvas width='100' height='100'/>")[0].getContext("2d");if(e.drawImage(t,0,0,100,100),0===t.src.indexOf("blob")&&URL.revokeObjectURL(t.src),Xt.toastRating){if(Xt.starRatingMode)for(var i=0;i<Yt.rating;i++)e.drawImage(n,64,0,32,32,16*i,84,16,16);else 1==Yt.rating||2==Yt.rating?e.drawImage(n,32,0,32,32,0,84,16,16):Yt.rating>=4&&e.drawImage(n,0,0,32,32,0,84,16,16);!0===Yt.loved&&e.drawImage(n,96,0,32,32,84,84,16,16)}Vt.iconUrl=e.canvas.toDataURL(),te(Bt,Vt)}}if(Yt.info&&Vt){var t=new Image,n=new Image,i=!1,o=!1;Xt.toastRating&&(Yt.rating>0||!0===Yt.loved)?(n.onload=function(){o=!0,i&&e()},n.src=Nt("img/rating.png")):o=!0,t.onload=function(){i=!0,o&&e()},Yt.info.cover?(kt=new XMLHttpRequest,kt.open("GET",Yt.info.cover,!0),kt.responseType="blob",kt.onload=function(){kt=null,t.src=URL.createObjectURL(this.response)},kt.onerror=function(){kt=null,t.src=Nt("img/cover.png")},kt.send()):t.src=Nt("img/cover.png")}}function ke(){Vt=null,Yt.rl("rating loved",we),Xt.rl("toastRating",we),kt&&(kt.abort(),kt=null)}function Se(e){wt&&e==wt.id&&(wt=null,Tt.onRemoved.removeListener(Se))}function Le(e){var t=Xt.toastButton1,n=ye(t);n&&1!=e||(t=Xt.toastButton2,n=ye(t)),n&&vt(t,"toast")}function _e(){var e=[],t=ye(Xt.toastButton1);t&&e.push(t),(t=ye(Xt.toastButton2))&&e.push(t);var n={type:Xt.toastProgress?"progress":"basic",title:Yt.info.title,message:Yt.info.artist,contextMessage:Yt.info.album,iconUrl:"img/cover.png",buttons:e,priority:Xt.toastPriority-2,isClickable:!!Xt.toastClick};return Xt.toastProgress&&(n.progress=Math.floor(100*Yt.positionSec/Yt.info.durationSec)),n}function Ce(e){clearTimeout(hn),$.isFunction(e)||(e=$.noop),Vt?ne(Bt,e):wt?Tt.remove(wt.id,e):e()}function Ie(){Ce(function(){if(Xt.toastUseMpStyle)Oe("toast",function(e){wt=e,Tt.onRemoved.addListener(Se)},!1);else{var e=_e();oe(Bt,e,function(t){Vt=e,ie("close",t,ke),ie("click",t,function(){Xt.toastClick&&vt(Xt.toastClick,"toast")}),ie("btnClick",t,Le),Yt.w("rating loved",we),Xt.al("toastRating",we)}),Xt.toastDuration>0&&(hn=setTimeout(Ce,1e3*Xt.toastDuration))}})}function Pe(){function e(){Xt.toastNotIfGmActive?xt.get(Lt,function(e){e.active?Tt.get(e.windowId,function(e){e.focused||Ie()}):Ie()}):Ie()}(Kt||Xt.mpAutoOpen&&!Zt.playing)&&!Xt.toastIfMpOpen||(Kt&&Xt.toastIfMpMinimized?Tt.get(Kt.id,function(t){"minimized"==t.state&&e()}):e())}function Ae(){if(Vt&&Yt.info){var e=Vt.iconUrl;Vt=_e(),Vt.iconUrl=e,te(Bt,Vt)}}function Me(e,t,n,i){var o=!0===t||!Xt.openGmBackground&&!n;if(Lt)o&&xt.update(Lt,{active:!0});else if(!Ht){var r="http://play.google.com/music/listen";Qt.googleAccountNo&&(r+="?u="+Qt.googleAccountNo),"string"==typeof e&&(r+="#/"+e);var a=i?xt.update:xt.create;a({url:r,pinned:Xt.openGoogleMusicPinned,active:o},function(e){Pt=e.id,Ht=!0,et(),de(),Be()})}}function Re(e){T({type:"setConfirmClose",confirmClose:e})}function xe(){Lt&&(Re(!1),xt.remove(Lt))}function Te(e){Kt&&e==Kt.id&&(Tt.onRemoved.removeListener(Te),Kt=null,wn?(Ue(),wn=!1):Xt.mpCloseGm&&xe())}function Oe(e,t,n){var i=Qt.miniplayerSizing[Xt.layout];Tt.create({url:Nt("player.html")+"?type="+e,height:i.height,width:i.width,top:i.top,left:i.left,type:Xt.miniplayerType,focused:n},t)}function Ue(){if(Xt.toastIfMpOpen&&!Xt.toastIfMpMinimized||Ce(),Kt)return wn=!0,void Tt.remove(Kt.id);Oe("miniplayer",function(e){Kt=e,Tt.onRemoved.addListener(Te)},!0)}function Ee(e){e&&null===Kt&&Ue()}function Ne(e){!e&&Kt&&Tt.remove(Kt.id)}function $e(){Ot.setPopup({popup:""})}function Fe(){Ot.setPopup({popup:"player.html"})}function De(){clearTimeout(yn);var e=Xt["iconClickAction"+kn];if(Xt.iconDoubleClickTime){kn++;Xt["iconClickAction"+kn]||Fe(),yn=setTimeout(function(){$e(),kn=0,vt(e,"icon")},Xt.iconDoubleClickTime)}else vt(e,"icon")}function Ge(){Ot.onClicked.removeListener(De),$e()}function qe(){Xt.iconClickAction0?Ot.onClicked.addListener(De):Fe()}function Be(){Ge(),Ot.onClicked.removeListener(dt),Jt?Ot.setPopup({popup:"updateNotifier.html#"+Jt}):Zt.connected?qe():!Ht&&ut()?function(){$e(),Ot.onClicked.addListener(dt)}():Fe()}function ze(e){function n(e){return"btrue"==e}function i(e,t){Xt.coverClickLink==e&&(Xt.coverClickLink=t),Xt.titleClickLink==e&&(Xt.titleClickLink=t)}var o=localStorage.iconClickMiniplayer;o&&(n(o)?Xt.iconClickAction0="openMiniplayer":n(localStorage.iconClickPlayPause)&&(Xt.iconClickAction0="playPause"),localStorage.removeItem("iconClickMiniplayer"),localStorage.removeItem("iconClickPlayPause")),e<2.18&&!Xt.toastUseMpStyle&&(Xt.toastDuration=0);var r=localStorage.skipDislikedSongs;r&&(Xt.skipRatedLower=n(r)?1:0,localStorage.removeItem("skipDislikedSongs")),e<2.23&&(Xt.optionsMode="exp");var a=localStorage.searchresultSizing;a&&(Qt.mixedSizing=JSON.parse(a.substr(1)),localStorage.removeItem("searchresultSizing")),Ut.remove("ratingMode",t);var s=localStorage.iconClickConnect;s&&(n(s)?Xt.iconClickConnectAction="gotoGmusic":"openMiniplayer"!=Xt.iconClickAction0&&"feelingLucky"!=Xt.iconClickAction0||(Xt.iconClickConnectAction=Xt.iconClickAction0),localStorage.removeItem("iconClickConnect")),e<3&&(Qt.lyrics&&nn.songlyrics.checkPermission(function(e){e&&(Qt.lyricsProviders=["songlyrics"])}),Xt.skipRatedLower=parseInt(Xt.skipRatedLower)),e<3.4&&(i("rd","wms"),i("expnew","wnr"),i("exptop","wtc"),i("exprec",""),i("ap/google-play-recommends",""),Qt.quicklinks&&Qt.quicklinks.exptop&&(Qt.quicklinks.wtc=Et("quicklink_wtc"))),Xt.toastPriority<2&&(Xt.toastPriority=2),e<=3.8&&i("myPlaylists","wmp");var c=localStorage.pauseOnIdleSec;c&&(c=parseInt(c.substr(1)),c<0?Xt.pauseOnIdleSec=-c:e<4&&(Xt.pauseOnIdle=!0)),e<4&&(localStorage.removeItem("filterTimer"),localStorage.removeItem("filterLastfm"),localStorage.removeItem("filterToast"),localStorage.removeItem("filterMiniplayer"),localStorage.removeItem("filterLyrics"),localStorage.removeItem("filterLookfeel")),c||(Xt.pauseOnIdle=!1),localStorage.removeItem("ratingMode")}function je(e){function t(){Jt=e.reason,localStorage.viewUpdateNotifier=Jt,Be(),de()}"update"==e.reason?(Xt.updateNotifier&&(previousVersion=e.previousVersion,r(Rt.getManifest().version)?(localStorage.previousVersion=previousVersion,t()):previousVersion=null),ze(parseFloat(e.previousVersion))):"install"==e.reason&&t()}function Ke(){Jt=null,localStorage.removeItem("viewUpdateNotifier"),Be(),de()}function Ve(){var e={};e.miniplayerOpen=null!==Kt,e.nowPlayingSent=Yt.nowPlayingSent,e.scrobbled=Yt.scrobbled,e.songFf=Yt.ff,e.songPosition=Yt.position,e.songInfo=Yt.info,e.songTimestamp=Yt.timestamp,e.loved=Yt.loved,e.volumeBeforeMute=_t,localStorage.updateBackup=JSON.stringify(e),St&&(St.onDisconnect.removeListener(he),St.disconnect()),Wt.forEach(function(e){e.onDisconnect.removeListener(me),e.disconnect()}),setTimeout(function(){Rt.reload()},1e3)}function We(e){if(e<60)return Et("timerInMin",e+"");if(60==e)return Et("timerInOneHour");var t=e%60;return t?Math.floor(e/60)+":"+(t<10?"0"+t:t):Et("timerInHours",e/60+"")}function Je(e){return Math.max(0,Math.floor((Qt.timerEnd-$.now()/1e3)/e))}function He(){var e=Je(60),t=e<2?Et("timerInOneMinute"):We(e);return e<1&&(t="<"+t),Et("cancelTimer")+" ("+t+")"}function Qe(){clearTimeout(_n),clearTimeout(Cn),ne(jt);var e=$.now()/1e3,t=Math.max(0,Qt.timerEnd-e);_n=setTimeout(function(){Xe();var e,t,n;switch(Qt.timerAction){case"pause":Zt.playing&&(e=Et("timerNotificationMsgPause"),t=Et("timerNotificationBtnPause"),n=Q.bind(window,!0),Q(!1));break;case"closeGm":Lt&&(e=Et("timerNotificationMsgCloseGm"),t=Et("timerNotificationBtnCloseGm"),n=Me),xe()}Qt.timerNotify&&e&&oe(zt,{title:Et("timerNotificationTitle"),message:e,buttons:[{title:t}],isClickable:!1},function(e){function t(){ne(e)}function i(){t(),n()}ie("btnClick",e,i),setTimeout(t,1e4)})},1e3*t),Qt.timerPreNotify>0&&t>0&&(Cn=setTimeout(function(){function e(){return Et("pause"==Qt.timerAction?"timerWarningMsgPause":"timerWarningMsgCloseGm",""+Je(1))}Cn=null;var t={title:Et("timerWarningTitle"),message:e(),buttons:[{title:Et("cancelTimer")}],priority:1,isClickable:!1};oe(jt,t,function(n){function i(){Xe(),ne(n)}function o(){clearInterval(r)}var r;ie("btnClick",n,i),ie("close",n,o),r=setInterval(function(){t.message=e(),te(n,t)},1e3)})},Math.max(0,1e3*(t-Qt.timerPreNotify)))),In=setInterval(function(){Ft.update("stopTimer",{title:He()})},6e4)}function Xe(){clearInterval(In),In=null,clearTimeout(_n),_n=null,clearTimeout(Cn),Cn=null,ne(jt),Qt.timerEnd=Zt.connected?0:null}function Ye(e){Zt.connected&&e.forEach(function(e){Ft.update(e,{title:st(e),enabled:gt(e)},t)})}function Ze(){Ft.removeAll(function(){function e(e,t,n,i,o,r,a){Ft.create({contexts:["browser_action"],type:o||"normal",id:e,title:t,checked:r,parentId:i,enabled:a},n)}if(Qt.lastfmSessionKey&&e("toggleScrobble",Et("setting_scrobble"),null,null,"checkbox",Xt.scrobble),Zt.connected){e("menuConnected",Et("action"),function(){var t=["playPause","prevSong","nextSong","ff","rew","openMiniplayer","volumeUp","volumeDown","volumeMute","toggleRepeat","toggleShuffle"];Qt.lastfmSessionKey&&t.push("loveUnloveSong"),t.push("rate-1"),Xt.starRatingMode&&t.push("rate-2","rate-3","rate-4"),t.push("rate-5","feelingLucky"),Qt.lyrics&&t.push("openLyrics"),t.forEach(function(t){e(t,st(t),null,"menuConnected",null,null,gt(t))})})}else if(!Ht){e("menuDisconnected",Et("action"),function(){var t=["feelingLucky","gotoGmusic","openMiniplayer"];Xt.saveLastPosition&&t.unshift("resumeLastSong"),t.forEach(function(t){e(t,st(t),null,"menuDisconnected",null,null,gt(t))})})}if(!Ht){if(!Xt.hideFavorites&&Qt.favorites.length){e("menuFavorites",Et("favorites"),function(){Qt.favorites.forEach(function(t){e("fav_"+t.link,t.title,null,"menuFavorites")})})}e("menuQuicklinks",Et("quicklinks"),function(){a().forEach(function(t){e("ql_"+t,l(t).replace(/&/g,"&&"),null,"menuQuicklinks")})})}var t=Qt.timerEnd;if(null!==t)if(t)e("stopTimer",He());else{e("startTimer",Et("startTimerMenu"),function(){["pause","closeGm"].forEach(function(t){e("timerAction_"+t,Et("setting_timerAction_"+t),null,"startTimer","radio",Qt.timerAction==t)}),[5,10,30,60,120,180,240,360,600].forEach(function(t){e("timerActionIn_"+t,We(t),null,"startTimer")})})}})}function et(){clearTimeout(Pn),Pn=setTimeout(Ze,150)}function tt(e){Zt.playing&&("locked"==e&&Xt.pauseOnLock||"idle"==e&&Xt.pauseOnIdle)?(Q(!1),Ut.set({resumeOnActive:!0})):"active"==e&&Ut.get("resumeOnActive",function(e){e.resumeOnActive&&(Q(!0),Ut.remove("resumeOnActive"))})}function nt(){Dt.onStateChanged.removeListener(tt),(Xt.pauseOnLock||Xt.pauseOnIdle)&&(Xt.pauseOnIdle&&Dt.setDetectionInterval(Xt.pauseOnIdleSec),Dt.onStateChanged.addListener(tt))}function it(e){e?chrome.power.requestKeepAwake(Xt.keepAwakeLevel):chrome.power.releaseKeepAwake()}function ot(e){Xt.saveLastPosition&&St&&(Ut.set({lastSong:e,lastPosition:Yt.position,rating:Yt.rating}),It=e)}function rt(e,t){if(St&&Yt.info){var n={};n[e]=t,Ut.set(n)}}function at(){Zt.connected||("resumeLastSong"==Xt.iconClickConnectAction&&(de(),Be()),Ft.update("resumeLastSong",{enabled:gt("resumeLastSong"),title:st("resumeLastSong")},t))}function st(e){var t;switch(e){case"playPause":t=Zt.playing?"pauseSong":"resumeSong";break;case"resumeLastSong":if(It&&Xt.saveLastPosition)return Et("resumeLastSongWithTitle",It.artist+" - "+It.title);case"prevSong":case"nextSong":case"openMiniplayer":case"feelingLucky":case"gotoGmusic":t=e;break;case"rate-1":t=Xt.starRatingMode?"command_star1":"command_thumbsDown";break;case"rate-5":t=Xt.starRatingMode?"command_star5":"command_thumbsUp";break;case"loveUnloveSong":t=Yt.loved?"lastfmUnlove":"lastfmLove";break;default:t="command_"+e.replace(/-/g,"")}return Et(t)}function ct(e){var t=e;switch(e){case"playPause":t=Zt.playing?"pause":"play";break;case"rate-1":Xt.starRatingMode||(t="thumbsDown");break;case"rate-5":Xt.starRatingMode||(t="thumbsUp");break;case"loveUnloveSong":t=Yt.loved?"unloveSong":"loveSong"}return"img/cmd/"+t}function lt(e,t){Zt.arl("playing",e,"playPause"==t),Yt.arl("loved",e,"loveUnloveSong"==t),e()}function ut(){var e=Xt.iconClickConnectAction;return"resumeLastSong"!=e||Xt.saveLastPosition&&It?e:""}function ft(e){switch(e){case"resumeLastSong":c(H);break;case"gotoGmusic":Me();break;default:vt(e,"connect")}}function dt(){ft(Xt.iconClickConnectAction)}function mt(e){if(e)switch(e){case"closeMp":Kt&&Tt.remove(Kt.id);break;case"closeGm":xe();break;case"feelingLucky":W();break;default:K(e)}}function gt(e){if(!e)return!1;switch(e){case"playPause":return null!==Zt.playing;case"resumeLastSong":return Xt.saveLastPosition&&!!It;case"prevSong":return Zt.rewind;case"nextSong":return Zt.forward;case"ff":case"rew":return!!Yt.info;case"volumeUp":return!!Zt.volume&&"100"!=Zt.volume;case"volumeDown":return!!Zt.volume&&"0"!=Zt.volume;case"volumeMute":return!!Zt.volume;case"toggleRepeat":return!!Zt.repeat;case"toggleShuffle":return!!Zt.shuffle;case"loveUnloveSong":return!!Yt.info&&!!Qt.lastfmSessionKey;case"openLyrics":return Qt.lyrics&&!!Yt.info;default:if(0===e.indexOf("rate-")){var t=parseInt(e.substr(5,1));return!!Yt.info&&(Xt.starRatingMode||1==t||5==t)}}return!0}function pt(e){function t(e,t,n){t.arl(n,de,e&&Xt.iconShowAction)}t(0===e.indexOf("volume"),Zt,"volume"),t("prevSong"==e,Zt,"rewind"),t("nextSong"==e,Zt,"forward"),t("toggleRepeat"==e,Zt,"repeat"),t("toggleShuffle"==e,Zt,"shuffle"),t("loveUnloveSong"==e,Qt,"lastfmSessionKey"),t("openLyrics"==e,Qt,"lyrics")}function vt(e,t){switch(e){case"playPause":!t&&Xt.toastOnPlayPause&&Yt.info&&Pe();case"nextSong":case"prevSong":case"toggleRepeat":case"toggleShuffle":O(e);break;case"openMiniplayer":Ue();break;case"feelingLucky":W();break;case"showToast":Yt.info&&Ie();break;case"loveUnloveSong":!0===Yt.loved?L():S(!0);break;case"volumeUp":null!==Zt.volume&&"100"!=Zt.volume&&U(Math.min(100,parseInt(Zt.volume)+10)/100);break;case"volumeDown":null!==Zt.volume&&"0"!=Zt.volume&&U(Math.max(0,parseInt(Zt.volume)-10)/100);break;case"volumeMute":null!==Zt.volume&&(_t&&"0"==Zt.volume?(U(parseInt(_t)/100),_t=null):"0"!=Zt.volume&&(_t=Zt.volume,U(0)));break;case"ff":Yt.info&&Yt.info.durationSec>0&&N(Math.min(1,(Yt.positionSec+15)/Yt.info.durationSec));break;case"rew":Yt.info&&Yt.info.durationSec>0&&N(Math.max(0,(Yt.positionSec-15)/Yt.info.durationSec));break;case"openLyrics":Qt.lyrics&&Y();break;default:if(0===e.indexOf("rate-")&&Yt.info){var n=parseInt(e.substr(5,1));(!Xt.preventCommandRatingReset||!s(Yt.rating,n)||"icon"==t&&Xt.showRatingIndicator||"toast"==t&&Xt.toastRating)&&F(n)}}}function ht(e){return e&&e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function bt(e,t,n){clearInterval(Dn);var i=Et(e,t&&"<match>"+t+"</match>");if(Gt.setDefaultSuggestion({description:i}),n){var o="";Dn=setInterval(function(){o.length>2?o="":o+=".",Gt.setDefaultSuggestion({description:i+o})},1e3)}}function yt(){Nn=$n=null,clearTimeout(Fn),clearInterval(Dn)}var wt,kt,St,Lt,_t,Ct,It,Pt,At,Mt,Rt=chrome.runtime,xt=chrome.tabs,Tt=chrome.windows,Ot=chrome.browserAction,Ut=chrome.storage.local,Et=chrome.i18n.getMessage,Nt=Rt.getURL,$t=chrome.notifications,Ft=chrome.contextMenus,Dt=chrome.idle,Gt=chrome.omnibox,qt="LastFM",Bt="pp.toast",zt="pp.timerEnd",jt="pp.timerwarn",Kt=null,Vt=null,Wt=[],Jt=localStorage.viewUpdateNotifier||null,Ht=!1,Qt=new Bean({lastfmSessionKey:null,lastfmSessionName:null,googleAccountNo:0,syncSettings:!1,lyrics:!1,lyricsProviders:[],lyricsFontSize:11,lyricsWidth:250,lyricsOpacity:.9,miniplayerSizing:{normal:{width:310,height:153,left:0,top:0},compact1:{width:306,height:118,left:0,top:0},compact2:{width:211,height:163,left:0,top:0},hbar:{width:555,height:68,left:0,top:0}},playlistsListSizing:{width:350,height:320},playlistSizing:{width:500,height:295},albumContainersSizing:{width:220,height:320},mixedSizing:{width:350,height:320},quicklinksSizing:{width:280,height:150},favoritesSizing:{width:280,height:200},lyricsSizing:{width:400,height:400},timerMinutes:60,timerAction:"pause",timerNotify:!0,timerPreNotify:0,timerEnd:null,skipSongSeconds:0,notificationsEnabled:!0,quicklinks:{},favorites:[]},!0);Qt.setEqualsFn("quicklinks",Bean.objectEquals);var Xt=new Bean({iconStyle:"default",showPlayingIndicator:!0,showRatingIndicator:!1,showLovedIndicator:!1,showScrobbledIndicator:!0,showProgress:!1,showProgressColor:"#ff0000",showProgressColorPaused:"#800000",iconClickConnectAction:"",iconClickAction0:"",iconClickAction1:"",iconClickAction2:"",iconClickAction3:"",iconDoubleClickTime:0,iconShowAction:!0,saveLastPosition:!1,starRatingMode:!1,skipRatedLower:0,skipRatedThumbsDown:!1,hideFavorites:!1,openGoogleMusicPinned:!1,openGmBackground:!1,simulateActivity:!1,startupAction:"",playlistEndAction:"",pauseOnLock:!1,pauseOnIdle:!1,pauseOnIdleSec:60,keepAwakeLevel:"",connectedIndicator:!0,preventCommandRatingReset:!0,autoActivateGm:!0,autoRestoreGm:!0,confirmClose:!1,updateNotifier:!0,miniplayerType:"popup",layout:"normal",color:"turq",mpBgColor:"#eeeeee",mpTextColor:"#000000",coverClickLink:"now",titleClickLink:"ap/queue",openLinksInMiniplayer:!0,hideSearchfield:!1,hideRatings:!1,hideLucky:!1,omitUnknownAlbums:!1,mpAutoOpen:!1,mpAutoClose:!1,mpCloseGm:!1,mpShowTitle:!1,toast:!0,toastOnPlayPause:!1,toastDuration:0,toastIfMpOpen:!1,toastIfMpMinimized:!1,toastNotIfGmActive:!1,toastUseMpStyle:!1,toastPriority:3,toastProgress:!1,toastRating:!0,toastClick:"",toastButton1:"nextSong",toastButton2:"playPause",scrobble:!0,scrobblePercent:50,scrobbleTime:240,scrobbleMaxDuration:30,disableScrobbleOnFf:!1,scrobbleRepeated:!0,linkRatings:!1,linkRatingsMin:5,linkRatingsGpm:!1,linkRatingsAuto:!1,linkRatingsReset:!1,showLastfmInfo:!1,lastFmArtistFilter:"Subscribe to go ad-free",lyricsAutoNext:!1,openLyricsInMiniplayer:!0,lyricsAutoReload:!1,lyricsInGpm:!1,optionsMode:"beg"},!0);Qt.w("syncSettings",function(e){Xt.setSyncStorage(e)});var Yt=new Bean({position:"0:00",positionSec:0,info:null,rating:-1,loved:null,lastfmInfo:null,nowPlayingSent:!1,scrobbled:!1,scrobbleTime:-1,timestamp:null,ff:!1}),Zt=new Bean({shuffle:"",repeat:"",rewind:!1,forward:!1,playing:null,volume:null,navigationList:null,listrating:null,connected:!1,favicon:"img/icon/default/notconnected.png"}),en=new LastFM("1ecc0b24153df7dc6ac0229d6fcb8dda","fb4b74854f7a7b099c30bfe71236dfd5");en.session.key=Qt.lastfmSessionKey,en.session.name=Qt.lastfmSessionName,en.unavailableMessage=Et("lastfmUnavailable"),Yt.setEqualsFn("info",i),$t.onShowSettings.addListener(u);var tn=initGA(Xt,"bp",d(),m());Qt.al("lyrics lastfmSessionKey",g),Xt.al("scrobble toast layout",g),Xt.al("scrobblePercent toastDuration",function(){tn.setMetrics(m())});var nn=initLyricsProviders(tn),on=w.bind(window,!0),rn=w.bind(window,!1);en.sessionTimeoutCallback=function(){b(),oe("pp.relogin",{title:Et("lastfmSessionTimeout"),message:Et("lastfmRelogin"),priority:1,isClickable:!0},function(e){ie("click",e,function(){ne(e),h()})})};var an,sn,cn=!1,ln={},un=re.bind(window,"click"),fn=re.bind(window,"btnClick"),dn=re.bind(window,"close");$t.getPermissionLevel(se),$t.onPermissionLevelChanged.addListener(se);var mn,gn,pn,vn=0;Rt.onConnect.addListener(ve);var hn,bn={};xt.onRemoved.addListener(function(e){Pt==e&&(Ht=!1,Pt=null,et(),de(),Be())});var yn,wn=!1,kn=0;e.popupOpened=function(){kn>0&&(clearTimeout(yn),kn=0,Ge(),qe())},Rt.onInstalled.addListener(je),Rt.onUpdateAvailable.addListener(Ve),Rt.onSuspend.addListener(function(){Rt.onUpdateAvailable.removeListener(Ve)});var Sn=!1;if(localStorage.updateBackup){var Ln=JSON.parse(localStorage.updateBackup);localStorage.removeItem("updateBackup"),Yt.timestamp=Ln.songTimestamp,Yt.info=Ln.songInfo,Yt.positionSec=n(Ln.songPosition),Yt.position=Ln.songPosition,Yt.nowPlayingSent=Ln.nowPlayingSent,
Yt.ff=Ln.songFf,C(),Yt.scrobbled=Ln.scrobbled,Yt.loved=Ln.loved,Sn=!0,_t=Ln.volumeBeforeMute,Qt.timerEnd&&Qe(),Ln.miniplayerOpen&&Ue()}var _n,Cn,In,Pn;Ft.onClicked.addListener(function(e){var t=e.menuItemId;if(t.indexOf("timerAction_"))if(t.indexOf("timerActionIn_"))if(t.indexOf("fav_"))if(t.indexOf("ql_"))switch(t){case"stopTimer":Xe();break;case"toggleScrobble":Xt.scrobble=e.checked;break;case"resumeLastSong":case"gotoGmusic":ft(t);break;default:vt(t,"icon")}else z(t.substr(3));else K(t.substr(4));else{var n=parseInt(t.substr(14));Qt.timerMinutes=n,Qt.timerPreNotify>60*n&&(Qt.timerPreNotify=60*n),Qt.timerEnd=$.now()/1e3+60*n,Qe()}else Qt.timerAction=t.substr(12)}),Qt.w("lastfmSessionKey favorites timerEnd",et),Qt.al("lyrics",function(){Zt.connected&&et()}),Xt.al("saveLastPosition",function(){Zt.connected||Ht||et()}),Xt.al("hideFavorites starRatingMode",et),Xt.al("scrobble",function(e){Ft.update("toggleScrobble",{checked:e},t)}),Xt.w("pauseOnLock pauseOnIdle pauseOnIdleSec",nt),Xt.w("confirmClose",Re),Xt.w("iconClickAction0 iconClickConnectAction",Be),Xt.w("miniplayerType",function(){Kt&&Ue()}),Xt.al("layout",function(){if(Kt){var e=Qt.miniplayerSizing[Xt.layout];Tt.update(Kt.id,{height:e.height,width:e.width})}}),Xt.al("hideRatings",function(e){e||null!==Yt.loved||_()}),Xt.al("showLastfmInfo",function(e){e&&null===Yt.lastfmInfo&&_()}),Xt.al("lastFmArtistFilter",function(){C(),_()}),Xt.al("toastUseMpStyle",Ce),Xt.al("toastClick toastProgress starRatingMode",Ae),Xt.w("toastButton1",lt.bind(window,Ae)),Xt.w("toastButton2",lt.bind(window,function(){Ae()})),Xt.al("scrobble scrobbleMaxDuration scrobblePercent scrobbleTime disableScrobbleOnFf",C),Xt.w("iconClickAction0",lt.bind(window,function(){de()})),Xt.al("iconStyle iconClickConnectAction showProgressColor showProgressColorPaused starRatingMode",de),Xt.al("connectedIndicator",function(e){T({type:"connectedIndicator",show:e})}),Xt.w("mpAutoOpen",function(e){Zt.wrl("playing",Ee,e)}),Xt.w("mpAutoClose",function(e){Zt.arl("connected",Ne,e)}),Xt.al("lyricsInGpm lyricsAutoReload",D),Xt.al("starRatingMode",G),Xt.w("showPlayingIndicator showProgress",function(){Zt.arl("playing",de,Xt.showPlayingIndicator||Xt.showProgress),de()}),Xt.w("showScrobbledIndicator",function(e){Yt.arl("scrobbled",de,e),de()}),Xt.w("showLovedIndicator",function(e){Yt.arl("loved",de,e),de()}),Xt.w("showRatingIndicator",function(e){Yt.arl("rating",de,e),de()}),Xt.w("keepAwakeLevel",function(e){Zt.wrl("playing",it,!!e),e||it(!1)});var An=rt.bind(window,"lastPosition"),Mn=rt.bind(window,"rating"),Rn=rt.bind(window,"scrobbled"),xn=rt.bind(window,"scrobbleTime"),Tn=rt.bind(window,"ff"),On=rt.bind(window,"timestamp");Xt.w("saveLastPosition",function(e){ot(Yt.info),Yt.arl("position",An,e),Yt.arl("rating",Mn,e),Yt.wrl("scrobbled",Rn,e),Yt.wrl("scrobbleTime",xn,e),Yt.wrl("ff",Tn,e),Yt.wrl("timestamp",On,e),e?c(function(e){It=e.info,at()}):at()}),Xt.w("skipRatedLower",function(e){Xt.skipRatedThumbsDown=e>0}),Xt.al("skipRatedThumbsDown",function(e){Xt.skipRatedLower=e?2:0}),Qt.al("lastfmSessionName",C),Qt.al("lyrics lyricsFontSize lyricsWidth lyricsOpacity",D),Qt.w("notificationsEnabled",function(e,t){e?ae():(t&&tn.event("Options","notifications-disabled"),Xt.toast&&!Xt.toastUseMpStyle&&(Xt.toastUseMpStyle=!0))}),Zt.al("connected",function(e){e?(q(),j(),V(),J(),Xt.connectedIndicator&&T({type:"connectedIndicator",show:!0}),Qt.lyrics&&Xt.lyricsInGpm&&D(),Xt.starRatingMode&&G(),Xt.confirmClose&&Re(!0),Qt.timerEnd=0,At=$.now()):(Xe(),At=null)});var Un,En=null;Yt.al("position",function(e){var t=Un||Yt.positionSec,i=Yt.positionSec=n(e);if(Yt.info)if(Un&&(i>=Un||i>5)&&(Un=null),!Sn&&!Yt.ff&&i>t+5?(Yt.ff=!0,Xt.disableScrobbleOnFf&&!Yt.scrobbled&&(Yt.scrobbleTime=-1)):Yt.ff&&i<=5&&!Un&&(Yt.ff=!1,Xt.disableScrobbleOnFf&&C()),Sn=!1,2==i)Xt.skipRatedLower&&Yt.rating>0&&Yt.rating<=Xt.skipRatedLower&&X(),Yt.timestamp=null,Yt.nowPlayingSent=!1,Xt.scrobbleRepeated&&(Yt.scrobbled=!1,C());else if(i>=3){if(Qt.skipSongSeconds&&i>=Qt.skipSongSeconds&&X(),p()&&(Yt.timestamp||(Yt.timestamp=En||Math.round($.now()/1e3)-i,En=null),Yt.nowPlayingSent||(Yt.nowPlayingSent=!0,x()),!Yt.scrobbled&&Yt.scrobbleTime>=0&&i>=Yt.scrobbleTime&&(Yt.scrobbled=!0,R())),Xt.toastProgress&&Vt){var o=Math.floor(100*i/Yt.info.durationSec);o>Vt.progress&&(Vt.progress=o,te(Bt,Vt))}ce()&&ue(),Xt.simulateActivity&&At&&Zt.playing&&i>Yt.info.durationSec-3&&At<$.now()-36e5&&(At=$.now(),O("simulateActivity"))}}),Yt.al("info",function(e,t){if(Ct&&i(Ct.info,e)?(Yt.scrobbled=Ct.scrobbled,Yt.ff=Ct.ff,En=Ct.timestamp,Un=Ct.positionSec,Yt.scrobbled&&(Yt.scrobbleTime=Ct.scrobbleTime)):Yt.scrobbled=!1,Ct=null,Yt.nowPlayingSent=!1,Sn=!1,Yt.lastfmInfo=null,Yt.loved=null,Yt.timestamp=null,e?(e.durationSec=n(e.duration),Xt.toast&&Pe(),Xt.hideRatings&&!Xt.showLastfmInfo||_()):Ce(),ot(e),de(),C(),!t!=!e){var o=["prevSong","nextSong","ff","rew","openLyrics","rate-1","rate-5"];Xt.starRatingMode&&o.push("rate-2","rate-3","rate-4"),Ye(o)}e||mt(Xt.playlistEndAction)}),Rt.onStartup.addListener(ft.bind(window,Xt.startupAction)),Xt.w("iconClickAction0",pt),Xt.al("iconShowAction",function(){pt(Xt.iconClickAction0),de()}),Zt.al("playing",Ye.bind(window,["playPause"])),Zt.al("volume",Ye.bind(window,["volumeUp","volumeDown","volumeMute"])),Zt.al("rewind",Ye.bind(window,["prevSong"])),Zt.al("forward",Ye.bind(window,["nextSong"])),Zt.al("repeat",Ye.bind(window,["toggleRepeat"])),Zt.al("shuffle",Ye.bind(window,["toggleShuffle"])),Yt.al("loved",Ye.bind(window,["loveUnloveSong"])),chrome.commands.onCommand.addListener(vt);var Nn,$n,Fn,Dn;Gt.onInputChanged.addListener(function(e,t){if(yt(),e.indexOf("f "))e.trim().length>1?(bt("ob_loading",ht(e),!0),$n=e.trim(),Fn=setTimeout(function(){Nn=t,B(f($n))},500)):bt("ob_defaultsugg");else{var n=e.substr(2).trim();if(n){var i=[],o=new RegExp(ht(n),"gi");Qt.favorites.forEach(function(e){var t=ht(e.title);o.test(t)&&i.push({content:Et("ob_startsugg",t)+" - link:"+e.link,description:t.replace(o,"<match>$&</match>")})}),bt(i.length?"ob_foundfavorites":"ob_nofavorites",ht(n)),t(i)}else bt("ob_favoritessugg")}}),Gt.onInputEntered.addListener(function(e,t){var n=$n;yt();var i=e.lastIndexOf(" - link:"),o="currentTab"==t;i>=0?K(e.substr(i+" - link:".length),o,"newForegroundTab"==t):n&&z(f(n),o)}),Gt.onInputCancelled.addListener(yt),Zt.al("navigationList",function(e){if(e&&Nn&&e.link==f($n)){Zt.navigationList=null;var t=ht($n),n=[];if(!e.error&&!e.empty)for(var i=new RegExp(t,"gi"),o=0,r=0;o<e.lists.length;r++){o=0;for(var a=0;a<e.lists.length;a++){var s=e.lists[a],c=s.list[r];if(!c||"albumContainers"!=s.type&&"playlistsList"!=s.type)o++;else{var l=ht(c.title),u=l;if(c.subTitle){var d=" ("+ht(c.subTitle)+")";l+=d,u+="<dim>"+d+"</dim>"}u=u.replace(i,"<match>$&</match>")+"<dim> - "+ht(s.header)+"</dim>",n.push({content:Et("ob_startsugg",l)+" - link:"+("playlistsList"==s.type?c.titleLink:c.link),description:u})}}}bt(n.length?"ob_results":"ob_noresults",t),Nn(n)}}),c(function(e){It=e.info,at()}),function(){xt.query({url:"*://play.google.com/music/listen*"},function(e){e.forEach(function(e){xt.insertCSS(e.id,{file:"css/gpm.css"}),xt.executeScript(e.id,{file:"js/jquery.min.js"}),xt.executeScript(e.id,{file:"js/cs.js"})})})}(),p()&&A(),e.localSettings=Qt,e.settings=Xt,e.song=Yt,e.player=Zt,e.toTimeString=function(e){if(e>86400)return Et("moreThanOneDay");if(e<10)return"0:0"+e;if(e<60)return"0:"+e;for(var t="";;){var n=e%60;if(t=n+t,e==n)return t;t=(n<10?":0":":")+t,e=(e-n)/60}},e.extractUrlParam=function(e,t){var n=RegExp(e+"=(.*?)(&|$|#.*)").exec(t);return null===n||n.length<2?null:n[1]},e.parseSeconds=n,e.songsEqual=i,e.isNewerVersion=r,e.compareVersions=o,e.getQuicklinks=a,e.isRatingReset=s,e.getLastSong=c,e.getTextForQuicklink=l,e.openMiniplayer=Ue,e.openOptions=u,e.openGoogleMusicTab=Me,e.getSearchLink=f,e.getCommandOptionText=function(e){switch(e){case"playPause":case"resumeLastSong":return Et(e);case"loveUnloveSong":return Et("command_loveUnloveSong");default:return st(e)}},e.lastfm=en,e.isScrobblingEnabled=p,e.lastfmLogin=h,e.lastfmLogout=b,e.getLastfmInfo=y,e.love=on,e.unlove=rn,e.loveTrack=S,e.unloveTrack=L,e.loadCurrentLastfmInfo=_,e.getLastfmSession=function(e){function n(e){Rt.sendMessage({type:"lastfmStatusChanged",status:e})}n(!1),Mt&&(xt.remove(Mt,t),Mt=null),en.auth.getSession({token:e},{success:function(e){var t=e.session;Qt.lastfmSessionKey=t.key,Qt.lastfmSessionName=t.name,n(!0),en.session=t,tn.event(qt,"AuthorizeOK"),_(),A()},error:function(e,t){var i=Et("lastfmConnectError");t&&(i+=": "+t),n(i),tn.event(qt,"AuthorizeError-"+e)}})},e.executeInGoogleMusic=O,e.setVolume=U,e.setSongPosition=N,e.rate=F,e.loadNavigationList=B,e.selectLink=z,e.startPlaylist=K,e.executeFeelingLucky=W,e.resumeLastSong=H,e.executePlayPause=Q,e.lyricsProviders=nn,e.openLyrics=Y,e.fetchLyricsFrom=Z,e.fetchLyrics=ee,e.updateNotifierDone=Ke,e.updateInfosViewed=function(){previousVersion=null,localStorage.removeItem("previousVersion"),Ke()},e.startSleepTimer=Qe,e.clearSleepTimer=Xe}(this);